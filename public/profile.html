<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - Innovate</title>
  <link rel="stylesheet" href="/css/instagram.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Macondo&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
  <style>
    /* ===== 3D Portfolio — Trending Animated Dark Style ===== */
    :root {
      --pf-accent: #667eea;
      --pf-accent2: #764ba2;
      --pf-glow: rgba(102, 126, 234, 0.35);
      --pf-card-bg: rgba(20, 20, 35, 0.65);
      --pf-glass: rgba(255,255,255,0.04);
      --pf-border: rgba(255,255,255,0.08);
      --pf-text: #e8eaf6;
      --pf-text2: #9ea4b8;
      --pf-bg: #0a0a1a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--pf-bg);
      color: var(--pf-text);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* ===== Animated Background ===== */
    .pf-bg-canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      overflow: hidden;
      pointer-events: none;
    }

    .pf-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.3;
      animation: pfOrbFloat 20s ease-in-out infinite alternate;
    }

    .pf-orb-1 { width: 500px; height: 500px; background: var(--pf-accent); top: -10%; left: -10%; animation-duration: 25s; }
    .pf-orb-2 { width: 400px; height: 400px; background: var(--pf-accent2); bottom: -10%; right: -10%; animation-duration: 30s; animation-delay: -5s; }
    .pf-orb-3 { width: 300px; height: 300px; background: #00d2ff; top: 50%; left: 50%; animation-duration: 22s; animation-delay: -10s; }

    @keyframes pfOrbFloat {
      0% { transform: translate(0, 0) scale(1); }
      33% { transform: translate(60px, -40px) scale(1.1); }
      66% { transform: translate(-30px, 50px) scale(0.95); }
      100% { transform: translate(40px, -20px) scale(1.05); }
    }

    /* ===== Grid Particles ===== */
    .pf-grid-bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      pointer-events: none;
    }

    /* ===== Main Container ===== */
    .pf-container {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }

    /* ===== Top Nav ===== */
    .pf-topnav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      margin-bottom: 40px;
    }

    .pf-back-btn {
      background: var(--pf-glass);
      border: 1px solid var(--pf-border);
      color: var(--pf-text);
      width: 44px;
      height: 44px;
      border-radius: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .pf-back-btn:hover {
      background: rgba(102, 126, 234, 0.15);
      border-color: var(--pf-accent);
      transform: translateX(-3px);
    }

    .pf-nav-title {
      font-size: 14px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--pf-text2);
      font-weight: 500;
    }

    .pf-share-btn {
      background: var(--pf-glass);
      border: 1px solid var(--pf-border);
      color: var(--pf-text);
      width: 44px;
      height: 44px;
      border-radius: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .pf-share-btn:hover {
      background: rgba(102, 126, 234, 0.15);
      border-color: var(--pf-accent);
    }

    /* ===== Hero Section — Portfolio Style ===== */
    .pf-hero {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 48px;
      padding: 60px 0 60px;
      position: relative;
      text-align: left;
    }

    .pf-hero-left {
      flex: 1;
      min-width: 0;
    }

    .pf-hero-right {
      flex-shrink: 0;
    }

    .pf-hero-avatar-wrap {
      position: relative;
      width: 260px;
      height: 300px;
    }

    .pf-hero-avatar {
      width: 260px;
      height: 300px;
      border-radius: 24px;
      object-fit: cover;
      border: 3px solid transparent;
      background: linear-gradient(var(--pf-bg), var(--pf-bg)) padding-box,
                  linear-gradient(135deg, var(--pf-accent), var(--pf-accent2), #00d2ff) border-box;
      position: relative;
      z-index: 2;
      transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pf-hero-avatar:hover {
      transform: scale(1.04) rotateY(5deg);
    }

    .pf-hero-avatar-glow {
      position: absolute;
      inset: -12px;
      border-radius: 30px;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      opacity: 0.25;
      filter: blur(30px);
      z-index: 1;
      animation: pfPulse 3s ease-in-out infinite;
    }

    @keyframes pfPulse {
      0%, 100% { opacity: 0.2; transform: scale(1); }
      50% { opacity: 0.35; transform: scale(1.05); }
    }

    /* Instagram double-tap heart animation */
    @keyframes igHeartPop {
      0% { transform: translate(-50%,-50%) scale(0); opacity: 1; }
      30% { transform: translate(-50%,-50%) scale(1.3); opacity: 1; }
      50% { transform: translate(-50%,-50%) scale(1); opacity: 1; }
      100% { transform: translate(-50%,-50%) scale(1); opacity: 0; }
    }

    /* "HEY, I am" label */
    .pf-hero-greeting {
      font-size: 18px;
      color: var(--pf-text2);
      font-weight: 400;
      margin-bottom: 8px;
      letter-spacing: 0.5px;
    }

    .pf-hero-name {
      font-family: 'Macondo', cursive;
      font-size: 52px;
      font-weight: 400;
      margin-bottom: 8px;
      line-height: 1.15;
      letter-spacing: 1px;
    }

    .pf-hero-name .pf-name-hey {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .pf-hero-name .pf-name-iam {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .pf-hero-name .pf-name-user {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
      font-size: 58px;
    }

    .pf-hero-title {
      font-size: 16px;
      color: var(--pf-accent);
      font-weight: 500;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .pf-hero-bio {
      font-size: 16px;
      color: var(--pf-text2);
      max-width: 520px;
      margin: 0 0 28px;
      line-height: 1.7;
    }

    /* ===== Stats Row ===== */
    .pf-stats-row {
      display: flex;
      justify-content: center;
      gap: 32px;
      margin-bottom: 48px;
    }

    .pf-stat-card {
      background: var(--pf-card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--pf-border);
      border-radius: 20px;
      padding: 20px 32px;
      text-align: center;
      min-width: 120px;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: default;
      position: relative;
      overflow: hidden;
    }

    .pf-stat-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(102,126,234,0.1), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .pf-stat-card:hover {
      transform: translateY(-6px) scale(1.02);
      border-color: rgba(102,126,234,0.3);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 30px var(--pf-glow);
    }

    .pf-stat-card:hover::before { opacity: 1; }

    .pf-stat-number {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
    }

    .pf-stat-label {
      font-size: 12px;
      color: var(--pf-text2);
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-top: 4px;
    }

    /* ===== Section Titles ===== */
    .pf-section-title {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 28px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--pf-border);
    }

    .pf-section-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: white;
      flex-shrink: 0;
    }

    .pf-section-title h2 {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.3px;
    }

    .pf-section-title span {
      font-size: 13px;
      color: var(--pf-text2);
    }

    /* ===== Skills Section ===== */
    .pf-skills-section {
      margin-bottom: 60px;
    }

    .pf-skills-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .pf-skill-chip {
      background: var(--pf-card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--pf-border);
      border-radius: 50px;
      padding: 10px 22px;
      font-size: 14px;
      color: var(--pf-text);
      font-weight: 500;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: default;
      position: relative;
      overflow: hidden;
    }

    .pf-skill-chip::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      opacity: 0;
      transition: opacity 0.3s;
      border-radius: 50px;
    }

    .pf-skill-chip:hover {
      transform: translateY(-4px) scale(1.05);
      border-color: var(--pf-accent);
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.25);
    }

    .pf-skill-chip:hover::before { opacity: 0.15; }

    .pf-skill-chip span {
      position: relative;
      z-index: 1;
    }

    /* ===== 3D Project Cards ===== */
    .pf-projects-section {
      margin-bottom: 60px;
    }

    .pf-projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }

    .pf-project-card {
      background: var(--pf-card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--pf-border);
      border-radius: 20px;
      overflow: hidden;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: pointer;
      position: relative;
      transform-style: preserve-3d;
      perspective: 1000px;
    }

    .pf-project-card:hover {
      transform: translateY(-12px) rotateX(2deg) rotateY(-2deg);
      border-color: rgba(102, 126, 234, 0.4);
      box-shadow:
        0 30px 60px rgba(0,0,0,0.4),
        0 0 40px var(--pf-glow),
        inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .pf-project-thumb {
      width: 100%;
      aspect-ratio: 16/10;
      object-fit: cover;
      display: block;
      transition: transform 0.6s ease;
    }

    .pf-project-card:hover .pf-project-thumb {
      transform: scale(1.05);
    }

    .pf-project-thumb-placeholder {
      width: 100%;
      aspect-ratio: 16/10;
      background: linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: var(--pf-accent);
    }

    .pf-project-body {
      padding: 20px;
    }

    .pf-project-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--pf-text);
    }

    .pf-project-desc {
      font-size: 13px;
      color: var(--pf-text2);
      line-height: 1.6;
      margin-bottom: 16px;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .pf-project-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 16px;
    }

    .pf-project-tag {
      background: rgba(102, 126, 234, 0.12);
      border: 1px solid rgba(102, 126, 234, 0.2);
      color: var(--pf-accent);
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 6px;
      font-weight: 500;
    }

    .pf-project-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding-top: 12px;
      border-top: 1px solid var(--pf-border);
    }

    .pf-project-link {
      color: var(--pf-accent);
      font-size: 13px;
      font-weight: 600;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: gap 0.3s ease;
    }

    .pf-project-link:hover { gap: 10px; }

    .pf-project-date {
      font-size: 12px;
      color: var(--pf-text2);
    }

    /* ===== Interests Section ===== */
    .pf-interests-section {
      margin-bottom: 60px;
    }

    .pf-interests-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }

    .pf-interest-card {
      background: var(--pf-card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--pf-border);
      border-radius: 16px;
      padding: 24px 20px;
      text-align: center;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      cursor: default;
    }

    .pf-interest-card:hover {
      transform: translateY(-8px) scale(1.03);
      border-color: rgba(102, 126, 234, 0.3);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 20px var(--pf-glow);
    }

    .pf-interest-icon {
      font-size: 32px;
      margin-bottom: 12px;
      display: block;
    }

    .pf-interest-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--pf-text);
    }

    /* ===== Instagram-Style Profile Posts Section ===== */
    .pf-ig-posts-section {
      margin-bottom: 60px;
    }

    /* Tab Bar */
    .pf-ig-tabs {
      display: flex;
      justify-content: center;
      border-top: 1px solid var(--pf-border);
      margin-bottom: 0;
    }

    .pf-ig-tab {
      flex: 1;
      max-width: 160px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 14px 0;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--pf-text2);
      border-top: 2px solid transparent;
      margin-top: -1px;
      transition: all 0.2s ease;
      background: none;
      border-left: none;
      border-right: none;
      border-bottom: none;
    }

    .pf-ig-tab:hover {
      color: var(--pf-text);
    }

    .pf-ig-tab.active {
      color: var(--pf-text);
      border-top-color: var(--pf-text);
    }

    .pf-ig-tab svg {
      width: 12px;
      height: 12px;
    }

    /* 3-Column Square Grid */
    .pf-ig-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2px;
    }

    .pf-ig-grid-item {
      position: relative;
      aspect-ratio: 1;
      cursor: pointer;
      overflow: hidden;
      background: var(--pf-card-bg);
    }

    .pf-ig-grid-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.2s;
    }

    .pf-ig-grid-item:hover img {
      opacity: 0.7;
    }

    /* Hover overlay with likes/comments */
    .pf-ig-grid-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      background: rgba(0,0,0,0.35);
      opacity: 0;
      transition: opacity 0.2s;
      color: white;
      font-weight: 700;
      font-size: 15px;
    }

    .pf-ig-grid-item:hover .pf-ig-grid-overlay {
      opacity: 1;
    }

    .pf-ig-grid-stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pf-ig-grid-stat i {
      font-size: 18px;
    }

    /* Text-only post in grid */
    .pf-ig-grid-text {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      font-size: 13px;
      color: var(--pf-text);
      text-align: center;
      line-height: 1.4;
      overflow: hidden;
      background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));
    }

    /* Multi-image / carousel indicator */
    .pf-ig-grid-multi {
      position: absolute;
      top: 8px;
      right: 8px;
      color: white;
      font-size: 16px;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.5));
      z-index: 2;
    }

    /* Video / Reel indicator */
    .pf-ig-grid-video {
      position: absolute;
      top: 8px;
      right: 8px;
      color: white;
      font-size: 18px;
      filter: drop-shadow(0 1px 3px rgba(0,0,0,0.5));
      z-index: 2;
    }

    /* Empty state for grid */
    .pf-ig-empty {
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 20px;
      color: var(--pf-text2);
    }

    .pf-ig-empty-icon {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 2px solid var(--pf-text2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
    }

    .pf-ig-empty-icon i {
      font-size: 28px;
      opacity: 0.5;
    }

    .pf-ig-empty h3 {
      font-size: 22px;
      font-weight: 300;
      color: var(--pf-text);
      margin-bottom: 8px;
    }

    .pf-ig-empty p {
      font-size: 14px;
    }

    /* Pinned post badge */
    .pf-ig-grid-pinned {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 4px;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* ===== Contact / Social Links ===== */
    .pf-contact-section {
      margin-bottom: 60px;
    }

    .pf-social-grid {
      display: flex;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .pf-social-btn {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: var(--pf-card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--pf-border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      color: var(--pf-text);
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-decoration: none;
    }

    .pf-social-btn:hover {
      transform: translateY(-6px) scale(1.1);
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      border-color: transparent;
      color: white;
      box-shadow: 0 12px 30px var(--pf-glow);
    }

    /* ===== Edit Portfolio Modal ===== */
    .pf-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      z-index: 9999;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .pf-modal {
      background: #14142b;
      border: 1px solid var(--pf-border);
      border-radius: 24px;
      max-width: 600px;
      width: 100%;
      max-height: 85vh;
      overflow-y: auto;
      animation: pfModalIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes pfModalIn {
      from { transform: scale(0.9) translateY(30px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .pf-modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--pf-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .pf-modal-header h3 {
      font-size: 18px;
      font-weight: 700;
    }

    .pf-modal-close {
      background: none;
      border: none;
      color: var(--pf-text2);
      font-size: 24px;
      cursor: pointer;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      transition: all 0.2s;
    }

    .pf-modal-close:hover {
      background: rgba(255,255,255,0.1);
      color: var(--pf-text);
    }

    .pf-modal-body {
      padding: 24px;
    }

    .pf-form-group {
      margin-bottom: 20px;
    }

    .pf-form-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--pf-text2);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .pf-form-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--pf-border);
      border-radius: 12px;
      color: var(--pf-text);
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    .pf-form-input:focus {
      border-color: var(--pf-accent);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
    }

    .pf-form-input::placeholder { color: rgba(255,255,255,0.2); }

    textarea.pf-form-input {
      resize: vertical;
      min-height: 80px;
    }

    .pf-modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--pf-border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .pf-btn {
      padding: 10px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
    }

    .pf-btn-primary {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      color: white;
    }

    .pf-btn-primary:hover {
      box-shadow: 0 8px 24px var(--pf-glow);
      transform: translateY(-2px);
    }

    .pf-btn-secondary {
      background: var(--pf-glass);
      color: var(--pf-text);
      border: 1px solid var(--pf-border);
    }

    .pf-btn-secondary:hover {
      background: rgba(255,255,255,0.08);
    }

    /* ===== Project Card Add ===== */
    .pf-project-add {
      border: 2px dashed rgba(102, 126, 234, 0.3);
      background: transparent;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 280px;
      color: var(--pf-text2);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.4s;
      border-radius: 20px;
    }

    .pf-project-add:hover {
      border-color: var(--pf-accent);
      background: rgba(102, 126, 234, 0.05);
      color: var(--pf-accent);
      transform: translateY(-4px);
    }

    .pf-project-add i {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    /* ===== Empty State ===== */
    .pf-empty {
      text-align: center;
      padding: 48px 20px;
      color: var(--pf-text2);
    }

    .pf-empty i {
      font-size: 56px;
      margin-bottom: 16px;
      display: block;
      opacity: 0.15;
    }

    .pf-empty h3 { font-size: 18px; margin-bottom: 8px; color: var(--pf-text); }
    .pf-empty p { font-size: 14px; line-height: 1.6; }

    /* ===== Scroll Animations ===== */
    .pf-reveal {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.7s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pf-reveal.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* ===== Footer ===== */
    .pf-footer {
      text-align: center;
      padding: 40px 20px;
      border-top: 1px solid var(--pf-border);
      margin-top: 40px;
    }

    .pf-footer-text {
      font-size: 13px;
      color: var(--pf-text2);
    }

    .pf-footer-brand {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      .pf-hero {
        flex-direction: column-reverse;
        text-align: center;
        gap: 28px;
        padding: 30px 0 40px;
      }
      .pf-hero-left { width: 100%; }
      .pf-hero-bio { margin: 0 auto 28px; }
      .pf-hero-avatar-wrap {
        width: 180px;
        height: 210px;
      }
      .pf-hero-avatar {
        width: 180px;
        height: 210px;
      }
      .pf-hero-name { font-size: 32px; }
      .pf-hero-name .pf-name-user { font-size: 36px; }
      .pf-stats-row { gap: 16px; flex-wrap: wrap; }
      .pf-stat-card { padding: 16px 20px; min-width: 90px; }
      .pf-stat-number { font-size: 22px; }
      .pf-projects-grid { grid-template-columns: 1fr; }
      .pf-interests-grid { grid-template-columns: repeat(2, 1fr); }
      .pf-ig-grid { gap: 1px; }
      .pf-container { padding: 12px; }
    }

    /* ===== Scrollbar ===== */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

    /* ===== Post Actions Modal (matches home feed exactly) ===== */
    .post-actions-sheet {
      width: 400px;
      max-width: 92vw;
      background: var(--ig-primary-background);
      border-radius: 16px;
      overflow: hidden;
      animation: slideUp 0.25s ease;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .post-actions-header {
      text-align: center;
      padding: 16px 16px 0;
    }
    .post-actions-handle {
      width: 40px;
      height: 4px;
      background: var(--ig-border);
      border-radius: 4px;
      margin: 0 auto 12px;
    }
    .post-actions-list {
      padding: 4px 0 8px;
    }
    .post-action-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 14px 20px;
      cursor: pointer;
      transition: background 0.15s;
      color: var(--ig-primary-text);
      font-size: 15px;
    }
    .post-action-item:hover {
      background: var(--ig-hover);
    }
    .post-action-item .action-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--ig-secondary-background);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .post-action-item .action-icon svg {
      width: 20px;
      height: 20px;
    }
    .post-action-item.danger {
      color: #ed4956;
    }
    .post-action-item.danger .action-icon {
      background: rgba(237,73,86,0.1);
    }
    .post-actions-cancel {
      display: block;
      width: 100%;
      padding: 16px;
      text-align: center;
      border: none;
      border-top: 1px solid var(--ig-border);
      background: none;
      color: var(--ig-primary-text);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.15s;
    }
    .post-actions-cancel:hover { background: var(--ig-hover); }

    /* ===== Reminder Modal Header ===== */
    .ig-modal-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--ig-border);
      font-weight: 600;
      text-align: center;
      color: var(--ig-primary-text);
    }

    /* ===== Edit Post Modal — exact copy from home feed cp-* system ===== */
    .cp-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 10002;
      display: flex; align-items: center; justify-content: center;
      animation: cpFadeIn 0.2s ease;
      padding: 16px;
    }
    @keyframes cpFadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes cpSlideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .cp-container {
      background: var(--ig-primary-background);
      border-radius: 16px;
      width: 100%; max-width: 520px; max-height: 90vh;
      display: flex; flex-direction: column;
      animation: cpSlideUp 0.3s ease;
      overflow: hidden;
      border: 1px solid var(--ig-border);
    }
    .cp-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 12px 16px;
      border-bottom: 1px solid var(--ig-border);
      min-height: 52px;
    }
    .cp-header-btn {
      background: none; border: none; color: var(--ig-primary-text);
      cursor: pointer; padding: 4px; display: flex; align-items: center;
      border-radius: 50%; transition: background 0.2s;
    }
    .cp-header-btn:hover { background: var(--ig-hover); }
    .cp-header-title { font-size: 16px; font-weight: 600; color: var(--ig-primary-text); margin: 0; }
    .cp-share-btn {
      background: none; border: none; color: var(--ig-blue);
      font-size: 14px; font-weight: 600; cursor: pointer;
      padding: 8px 16px; border-radius: 8px; transition: all 0.2s;
    }
    .cp-share-btn:hover { background: rgba(0,149,246,0.1); }
    .cp-share-btn:disabled { opacity: 0.4; cursor: default; }
    .cp-share-btn.cp-sharing { color: var(--ig-secondary-text); pointer-events: none; }
    .cp-body { overflow-y: auto; flex: 1; padding: 0; scrollbar-width: thin; }
    .cp-user-row { display: flex; align-items: center; gap: 12px; padding: 14px 16px 6px; }
    .cp-avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 1px solid var(--ig-border); }
    .cp-username { font-size: 14px; font-weight: 600; color: var(--ig-primary-text); }
    .cp-caption-wrap { padding: 4px 16px 8px; position: relative; }
    .cp-caption {
      width: 100%; border: none; outline: none; resize: none;
      font-size: 15px; line-height: 1.5; color: var(--ig-primary-text);
      background: transparent;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 80px;
    }
    .cp-caption::placeholder { color: var(--ig-secondary-text); }
    .cp-char-count { text-align: right; font-size: 12px; color: var(--ig-tertiary-text); padding-top: 4px; }
    .cp-hashtag-suggestions { padding: 0 16px 8px; }
    .cp-hashtag-header { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; color: var(--ig-secondary-text); margin-bottom: 8px; }
    .cp-hashtag-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .cp-hashtag-chip {
      padding: 6px 14px; background: rgba(0,149,246,0.1); color: var(--ig-blue);
      border: 1px solid rgba(0,149,246,0.2); border-radius: 20px;
      font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; user-select: none;
    }
    .cp-hashtag-chip:hover { background: rgba(0,149,246,0.2); border-color: var(--ig-blue); transform: translateY(-1px); }
    .cp-hashtag-chip.cp-hashtag-added { background: var(--ig-blue); color: white; border-color: var(--ig-blue); }
    .cp-trending-section { padding: 0 16px 8px; }
    .cp-trending-header { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; color: var(--ig-secondary-text); cursor: pointer; padding: 6px 0; user-select: none; }
    .cp-trending-chevron { margin-left: auto; transition: transform 0.3s; }
    .cp-trending-chevron.cp-open { transform: rotate(180deg); }
    .cp-trending-list { margin-top: 6px; }
    .cp-trending-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 10px; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
    .cp-trending-item:hover { background: var(--ig-hover); }
    .cp-trending-tag { font-size: 14px; font-weight: 500; color: var(--ig-primary-text); }
    .cp-trending-count { font-size: 12px; color: var(--ig-secondary-text); }
    .cp-media-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 4px; padding: 0 16px;
    }
    .cp-media-grid:empty { display: none; }
    .media-preview-item { position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 1; background: var(--ig-secondary-background); }
    .media-preview-item img, .media-preview-item video { width: 100%; height: 100%; object-fit: cover; }
    .media-preview-remove {
      position: absolute; top: 6px; right: 6px; background: rgba(0,0,0,0.75); color: white;
      border: none; border-radius: 50%; width: 26px; height: 26px; cursor: pointer;
      font-size: 14px; display: flex; align-items: center; justify-content: center;
      backdrop-filter: blur(4px); transition: transform 0.2s, background 0.2s;
    }
    .media-preview-remove:hover { background: var(--ig-error); transform: scale(1.1); }
    .cp-files-list { padding: 0 16px; }
    .cp-files-list:empty { display: none; }
    .file-preview-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; margin-bottom: 4px; background: var(--ig-secondary-background); border-radius: 10px; border: 1px solid var(--ig-border); }
    .file-preview-item span:first-child { font-size: 20px; }
    .file-preview-remove { margin-left: auto; background: none; border: none; color: var(--ig-error); cursor: pointer; font-size: 20px; padding: 2px 6px; border-radius: 4px; transition: background 0.2s; }
    .file-preview-remove:hover { background: rgba(237,73,86,0.1); }
    .cp-toolbar {
      display: flex; gap: 0; padding: 8px 8px;
      border-top: 1px solid var(--ig-border); border-bottom: 1px solid var(--ig-border); margin-top: 8px;
    }
    .cp-tool-btn {
      flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px;
      padding: 10px 4px; background: none; border: none;
      color: var(--ig-primary-text); cursor: pointer; border-radius: 10px; transition: all 0.2s;
      font-size: inherit; font-family: inherit;
    }
    .cp-tool-btn:hover { background: var(--ig-hover); }
    .cp-tool-btn.cp-tool-active { color: var(--ig-blue); background: rgba(0,149,246,0.08); }
    .cp-tool-label { font-size: 11px; color: var(--ig-secondary-text); font-weight: 500; }
    .cp-tool-btn:hover .cp-tool-label, .cp-tool-btn.cp-tool-active .cp-tool-label { color: var(--ig-blue); }
    .cp-section { margin: 0 16px 8px; padding: 14px; background: var(--ig-secondary-background); border-radius: 12px; border: 1px solid var(--ig-border); }
    .cp-section-header { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 600; color: var(--ig-primary-text); margin-bottom: 12px; }
    .cp-section-close { margin-left: auto; background: none; border: none; color: var(--ig-secondary-text); cursor: pointer; font-size: 22px; line-height: 1; padding: 0 4px; border-radius: 50%; transition: color 0.2s; }
    .cp-section-close:hover { color: var(--ig-error); }
    .cp-input { width: 100%; padding: 10px 12px; background: var(--ig-primary-background); border: 1px solid var(--ig-border); border-radius: 8px; color: var(--ig-primary-text); font-size: 14px; outline: none; transition: border-color 0.2s; }
    .cp-input:focus { border-color: var(--ig-blue); }
    .cp-input::placeholder { color: var(--ig-tertiary-text); }
    .cp-poll-options { margin: 10px 0; }
    .cp-poll-option-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
    .cp-poll-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
    .cp-add-option-btn { display: flex; align-items: center; gap: 6px; background: none; border: none; color: var(--ig-blue); font-size: 13px; font-weight: 600; cursor: pointer; padding: 6px 0; transition: opacity 0.2s; }
    .cp-add-option-btn:hover { opacity: 0.7; }
    .cp-poll-expiry { display: flex; align-items: center; gap: 8px; padding-top: 10px; margin-top: 10px; border-top: 1px solid var(--ig-border); }
    .cp-datetime-input { flex: 1; padding: 8px 10px; background: var(--ig-primary-background); border: 1px solid var(--ig-border); border-radius: 8px; color: var(--ig-primary-text); font-size: 13px; outline: none; }
    .cp-datetime-input:focus { border-color: var(--ig-blue); }
    .cp-expiry-label { font-size: 13px; color: var(--ig-secondary-text); white-space: nowrap; }
    .cp-schedule-picker { margin-top: 4px; }
    .cp-schedule-hint { margin-top: 8px; font-size: 12px; color: var(--ig-secondary-text); }
    .cp-advanced-toggle { display: flex; align-items: center; justify-content: space-between; padding: 12px 16px; cursor: pointer; color: var(--ig-secondary-text); font-size: 14px; border-top: 1px solid var(--ig-border); user-select: none; transition: color 0.2s; }
    .cp-advanced-toggle:hover { color: var(--ig-primary-text); }
    .cp-advanced-toggle svg { transition: transform 0.3s; }
    .cp-advanced-toggle.cp-open svg { transform: rotate(180deg); }
    .cp-advanced { padding: 0 16px 12px; }
    .cp-toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; cursor: pointer; border-bottom: 1px solid var(--ig-border); }
    .cp-toggle-row:last-child { border-bottom: none; }
    .cp-toggle-info { display: flex; align-items: center; gap: 12px; font-size: 14px; color: var(--ig-primary-text); }
    .cp-switch { position: relative; width: 44px; height: 24px; flex-shrink: 0; }
    .cp-switch input { opacity: 0; width: 0; height: 0; }
    .cp-switch-slider { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: var(--ig-border); border-radius: 24px; cursor: pointer; transition: all 0.3s; }
    .cp-switch-slider::before { content: ''; position: absolute; width: 20px; height: 20px; left: 2px; bottom: 2px; background: white; border-radius: 50%; transition: all 0.3s; }
    .cp-switch input:checked + .cp-switch-slider { background: var(--ig-blue); }
    .cp-switch input:checked + .cp-switch-slider::before { transform: translateX(20px); }
    @media (max-width: 540px) {
      .cp-container { max-width: 100%; max-height: 100vh; border-radius: 0; height: 100%; }
      .cp-overlay { padding: 0; }
      .cp-media-grid { grid-template-columns: repeat(3, 1fr); }
    }

    /* ===== Mouse 3D tilt for cards ===== */
    .pf-3d-tilt {
      transform-style: preserve-3d;
      will-change: transform;
    }

    /* ===== Profile Action Buttons ===== */
    .pf-action-buttons {
      display: flex;
      justify-content: flex-start;
      gap: 12px;
      margin-bottom: 48px;
      flex-wrap: wrap;
    }

    .pf-action-btn {
      padding: 10px 28px;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      border: 1px solid var(--pf-border);
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(20px);
    }

    .pf-action-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.3);
    }

    .pf-action-btn-primary {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      color: white;
      border: none;
    }

    .pf-action-btn-primary:hover {
      box-shadow: 0 12px 30px var(--pf-glow);
    }

    .pf-action-btn-secondary {
      background: var(--pf-card-bg);
      color: var(--pf-text);
    }

    .pf-action-btn-secondary:hover {
      background: rgba(102, 126, 234, 0.15);
      border-color: var(--pf-accent);
    }

    .pf-action-btn-follow {
      background: linear-gradient(135deg, #0095f6, #00d4ff);
      color: white;
      border: none;
      min-width: 120px;
      justify-content: center;
    }

    .pf-action-btn-following {
      background: var(--pf-card-bg);
      color: var(--pf-text);
      min-width: 120px;
      justify-content: center;
    }

    /* ===== Hero Avatar Upload Overlay ===== */
    .pf-hero-avatar-wrap {
      cursor: pointer;
    }

    .pf-avatar-upload-overlay {
      position: absolute;
      inset: 0;
      border-radius: 24px;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 3;
    }

    .pf-hero-avatar-wrap:hover .pf-avatar-upload-overlay {
      opacity: 1;
    }

    .pf-avatar-upload-overlay i {
      font-size: 28px;
      color: white;
    }

    /* ===== Settings Drawer ===== */
    .pf-settings-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      backdrop-filter: blur(6px);
      z-index: 9998;
      display: none;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .pf-settings-overlay.active {
      display: block;
      opacity: 1;
    }

    .pf-settings-drawer {
      position: fixed;
      right: -420px;
      top: 0;
      bottom: 0;
      width: 400px;
      max-width: 90vw;
      background: #14142b;
      border-left: 1px solid var(--pf-border);
      z-index: 9999;
      overflow-y: auto;
      transition: right 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: -8px 0 40px rgba(0,0,0,0.5);
    }

    .pf-settings-drawer.active {
      right: 0;
    }

    .pf-settings-drawer-header {
      padding: 24px;
      border-bottom: 1px solid var(--pf-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: #14142b;
      z-index: 2;
    }

    .pf-settings-drawer-header h3 {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .pf-settings-section {
      padding: 16px 24px;
      border-bottom: 1px solid var(--pf-border);
    }

    .pf-settings-section-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: var(--pf-text2);
      margin-bottom: 12px;
    }

    .pf-settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 4px;
    }

    .pf-settings-item:hover {
      background: rgba(102, 126, 234, 0.08);
    }

    .pf-settings-item-left {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .pf-settings-item-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: rgba(102, 126, 234, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: var(--pf-accent);
    }

    .pf-settings-item-label {
      font-size: 14px;
      font-weight: 500;
      color: var(--pf-text);
    }

    .pf-settings-item-desc {
      font-size: 11px;
      color: var(--pf-text2);
      margin-top: 2px;
    }

    .pf-settings-item-chevron {
      color: var(--pf-text2);
      font-size: 14px;
    }

    /* Toggle Switch */
    .pf-toggle {
      width: 44px;
      height: 24px;
      border-radius: 12px;
      background: rgba(255,255,255,0.1);
      position: relative;
      cursor: pointer;
      transition: background 0.3s;
      flex-shrink: 0;
    }

    .pf-toggle.active {
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
    }

    .pf-toggle::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      top: 2px;
      left: 2px;
      transition: transform 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .pf-toggle.active::after {
      transform: translateX(20px);
    }

    /* ===== Followers/Following List Modal ===== */
    .pf-list-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      z-index: 10000;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .pf-list-modal {
      background: #14142b;
      border: 1px solid var(--pf-border);
      border-radius: 24px;
      max-width: 440px;
      width: 100%;
      max-height: 70vh;
      overflow: hidden;
      animation: pfModalIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pf-list-modal-header {
      padding: 18px 24px;
      border-bottom: 1px solid var(--pf-border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .pf-list-modal-header h3 {
      font-size: 16px;
      font-weight: 700;
    }

    .pf-list-modal-body {
      overflow-y: auto;
      max-height: calc(70vh - 70px);
    }

    .pf-user-list-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 24px;
      cursor: pointer;
      transition: background 0.2s;
      text-decoration: none;
      color: inherit;
    }

    .pf-user-list-item:hover {
      background: rgba(102, 126, 234, 0.08);
    }

    .pf-user-list-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--pf-border);
    }

    .pf-user-list-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--pf-text);
    }

    .pf-user-list-bio {
      font-size: 12px;
      color: var(--pf-text2);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      max-width: 240px;
    }

    /* ===== Edit Profile Modal Extended ===== */
    .pf-edit-avatar-section {
      text-align: center;
      margin-bottom: 24px;
    }

    .pf-edit-avatar-wrap {
      position: relative;
      display: inline-block;
      margin-bottom: 12px;
    }

    .pf-edit-avatar-img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--pf-border);
    }

    .pf-edit-avatar-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      border: 3px solid #14142b;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: transform 0.2s;
    }

    .pf-edit-avatar-btn:hover {
      transform: scale(1.1);
    }

    .pf-edit-change-photo {
      color: var(--pf-accent);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .pf-edit-change-photo:hover {
      text-decoration: underline;
    }

    /* ===== Toast Notification ===== */
    .pf-toast {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      color: white;
      padding: 12px 28px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      z-index: 99999;
      animation: pfModalIn 0.3s ease;
      box-shadow: 0 8px 32px var(--pf-glow);
    }

    /* ===== Danger/Delete styles ===== */
    .pf-danger-text { color: #ef4444 !important; }

    .pf-settings-item.danger:hover {
      background: rgba(239, 68, 68, 0.08);
    }

    .pf-settings-item.danger .pf-settings-item-icon {
      background: rgba(239, 68, 68, 0.12);
      color: #ef4444;
    }

    /* ===== All Posts Grid ===== */
    .pf-posts-grid-section {
      margin-bottom: 60px;
    }

    .pf-posts-instagram-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 4px;
    }

    .pf-posts-grid-item {
      position: relative;
      aspect-ratio: 1;
      cursor: pointer;
      overflow: hidden;
      border-radius: 4px;
      background: var(--pf-card-bg);
    }

    .pf-posts-grid-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s, opacity 0.3s;
    }

    .pf-posts-grid-item:hover img {
      transform: scale(1.05);
      opacity: 0.7;
    }

    .pf-posts-grid-item .pf-grid-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      background: rgba(0,0,0,0.3);
      opacity: 0;
      transition: opacity 0.3s;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }

    .pf-posts-grid-item:hover .pf-grid-overlay {
      opacity: 1;
    }

    .pf-grid-stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pf-posts-grid-item .pf-grid-text-post {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      font-size: 13px;
      color: var(--pf-text);
      text-align: center;
      line-height: 1.4;
      overflow: hidden;
    }

    .pf-posts-grid-item .pf-grid-multi-icon {
      position: absolute;
      top: 8px;
      right: 8px;
      color: white;
      font-size: 16px;
      text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }

    .pf-posts-grid-item .pf-archive-badge {
      position: absolute;
      top: 8px;
      left: 8px;
      background: rgba(0,0,0,0.6);
      color: white;
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 4px;
    }

    /* ===== User List Enhanced Styles ===== */
    .pf-user-list-actions {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    .pf-follow-back-btn {
      background: linear-gradient(135deg, #0095f6, #00d4ff);
      color: white;
      border: none;
      padding: 6px 16px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pf-follow-back-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,149,246,0.3);
    }

    .pf-follow-back-btn.following {
      background: var(--pf-card-bg);
      color: var(--pf-text);
      border: 1px solid var(--pf-border);
    }

    .pf-remove-btn {
      background: none;
      border: none;
      color: var(--pf-text2);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 16px;
      transition: all 0.2s;
    }

    .pf-remove-btn:hover {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }

    .pf-message-btn {
      background: var(--pf-card-bg);
      color: var(--pf-text);
      border: 1px solid var(--pf-border);
      padding: 6px 16px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .pf-message-btn:hover {
      background: rgba(102, 126, 234, 0.15);
      border-color: var(--pf-accent);
    }

    .pf-more-btn {
      background: none;
      border: none;
      color: var(--pf-text2);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 18px;
      transition: all 0.2s;
      position: relative;
    }

    .pf-more-btn:hover {
      background: rgba(255,255,255,0.08);
      color: var(--pf-text);
    }

    /* ===== Dropdown Menu ===== */
    .pf-dropdown-menu {
      position: absolute;
      right: 0;
      top: 100%;
      background: #1e1e3a;
      border: 1px solid var(--pf-border);
      border-radius: 12px;
      min-width: 160px;
      overflow: hidden;
      z-index: 100;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      animation: pfModalIn 0.2s ease;
    }

    .pf-dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      font-size: 14px;
      color: var(--pf-text);
      cursor: pointer;
      transition: background 0.2s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
    }

    .pf-dropdown-item:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    .pf-dropdown-item.danger {
      color: #ef4444;
    }

    .pf-dropdown-item.danger:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    /* ===== Share Modal ===== */
    .pf-share-modal {
      background: #14142b;
      border: 1px solid var(--pf-border);
      border-radius: 24px;
      max-width: 480px;
      width: 100%;
      max-height: 80vh;
      overflow: hidden;
      animation: pfModalIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pf-share-search {
      padding: 12px 16px;
      border-bottom: 1px solid var(--pf-border);
    }

    .pf-share-search input {
      width: 100%;
      padding: 10px 16px;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--pf-border);
      border-radius: 20px;
      color: var(--pf-text);
      font-size: 14px;
      outline: none;
    }

    .pf-share-search input:focus {
      border-color: var(--pf-accent);
    }

    .pf-share-section-title {
      padding: 12px 16px 6px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--pf-text2);
    }

    .pf-share-users {
      max-height: 300px;
      overflow-y: auto;
    }

    .pf-share-user-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .pf-share-user-item:hover {
      background: rgba(102, 126, 234, 0.08);
    }

    .pf-share-user-item .pf-share-send-btn {
      margin-left: auto;
      background: linear-gradient(135deg, var(--pf-accent), var(--pf-accent2));
      color: white;
      border: none;
      padding: 6px 16px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
    }

    .pf-share-user-item .pf-share-send-btn:hover {
      opacity: 0.9;
    }

    .pf-share-user-item .pf-share-send-btn.sent {
      background: var(--pf-card-bg);
      color: var(--pf-text2);
      border: 1px solid var(--pf-border);
    }

    .pf-share-apps {
      padding: 12px 16px;
      display: flex;
      gap: 16px;
      overflow-x: auto;
      border-top: 1px solid var(--pf-border);
    }

    .pf-share-app {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      min-width: 60px;
      font-size: 11px;
      color: var(--pf-text2);
    }

    .pf-share-app-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      transition: transform 0.2s;
    }

    .pf-share-app:hover .pf-share-app-icon {
      transform: scale(1.1);
    }

    @media (max-width: 768px) {
      .pf-posts-instagram-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 2px;
      }
      .pf-ig-grid { gap: 1px; }
      .pf-ig-tabs { gap: 0; }
      .pf-ig-tab { font-size: 11px; letter-spacing: 0.5px; }
      .pf-ig-grid-overlay { font-size: 13px; gap: 12px; }
      .pf-ig-grid-stat i { font-size: 14px; }
    }
  </style>
  <link rel="stylesheet" href="/css/post-interactions.css">
</head>
<body>
  <!-- Animated Background -->
  <div class="pf-bg-canvas">
    <div class="pf-orb pf-orb-1"></div>
    <div class="pf-orb pf-orb-2"></div>
    <div class="pf-orb pf-orb-3"></div>
  </div>
  <div class="pf-grid-bg"></div>

  <div class="pf-container">
    <!-- Top Navigation -->
    <nav class="pf-topnav">
      <button class="pf-back-btn" onclick="goBack()" title="Back">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
      </button>
      <div class="pf-nav-title">Profile</div>
      <div style="display:flex;gap:8px;">
        <button class="pf-share-btn" id="pf-settings-btn" onclick="openSettingsDrawer()" title="Settings" style="display:none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        </button>
      </div>
    </nav>

    <!-- Hero Section — Portfolio Style -->
    <section class="pf-hero pf-reveal">
      <div class="pf-hero-left">
        <h1 id="pf-name" class="pf-hero-name">
          <span class="pf-name-hey">HEY</span><span class="pf-name-iam"> , I am </span><br>
          <span class="pf-name-user" id="pf-name-user"></span>
        </h1>
        <div id="pf-title" class="pf-hero-title"></div>
        <p id="pf-bio" class="pf-hero-bio"></p>

        <!-- Action Buttons (dynamic: Edit Profile/Settings for own, Follow/Message for others) -->
        <div class="pf-action-buttons" id="pf-action-buttons"></div>
      </div>

      <div class="pf-hero-right">
        <div class="pf-hero-avatar-wrap" id="pf-avatar-wrap" onclick="handleAvatarClick()">
          <div class="pf-hero-avatar-glow"></div>
          <img id="pf-avatar" class="pf-hero-avatar" src="" alt="Avatar">
          <div class="pf-avatar-upload-overlay" id="pf-avatar-overlay" style="display:none;">
            <i class="fas fa-camera"></i>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats -->
    <section class="pf-stats-row pf-reveal">
      <div class="pf-stat-card pf-3d-tilt" style="cursor:pointer;" onclick="showAllPosts()">
        <div class="pf-stat-number" id="pf-posts-count">0</div>
        <div class="pf-stat-label">Posts</div>
      </div>
      <div class="pf-stat-card pf-3d-tilt" style="cursor:pointer;" onclick="showFollowersList()">
        <div class="pf-stat-number" id="pf-followers-count">0</div>
        <div class="pf-stat-label">Followers</div>
      </div>
      <div class="pf-stat-card pf-3d-tilt" style="cursor:pointer;" onclick="showFollowingList()">
        <div class="pf-stat-number" id="pf-following-count">0</div>
        <div class="pf-stat-label">Following</div>
      </div>
      <div class="pf-stat-card pf-3d-tilt">
        <div class="pf-stat-number" id="pf-projects-count">0</div>
        <div class="pf-stat-label">Projects</div>
      </div>
    </section>

    <!-- Skills -->
    <section class="pf-skills-section pf-reveal" id="pf-skills-section" style="display:none;">
      <div class="pf-section-title">
        <div class="pf-section-icon"><i class="fas fa-bolt"></i></div>
        <div>
          <h2>Skills</h2>
          <span>Technologies & expertise</span>
        </div>
      </div>
      <div class="pf-skills-grid" id="pf-skills-grid"></div>
    </section>

    <!-- Projects / Portfolio Items -->
    <section class="pf-projects-section pf-reveal" id="pf-projects-section">
      <div class="pf-section-title">
        <div class="pf-section-icon"><i class="fas fa-rocket"></i></div>
        <div>
          <h2>Projects</h2>
          <span>Featured work & creations</span>
        </div>
        <button id="pf-add-project-btn" onclick="openProjectModal()" style="margin-left:auto;background:linear-gradient(135deg,var(--pf-accent),var(--pf-accent2));color:#fff;border:none;padding:8px 18px;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;display:none;transition:all 0.3s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 8px 24px rgba(102,126,234,0.3)'" onmouseout="this.style.transform='';this.style.boxShadow=''">
          <i class="fas fa-plus" style="margin-right:6px;"></i> Add Project
        </button>
      </div>
      <div class="pf-projects-grid" id="pf-projects-grid"></div>
    </section>

    <!-- Interests -->
    <section class="pf-interests-section pf-reveal" id="pf-interests-section" style="display:none;">
      <div class="pf-section-title">
        <div class="pf-section-icon"><i class="fas fa-heart"></i></div>
        <div>
          <h2>Interests</h2>
          <span>What drives the passion</span>
        </div>
      </div>
      <div class="pf-interests-grid" id="pf-interests-grid"></div>
    </section>

    <!-- Instagram-Style Posts Grid -->
    <section class="pf-ig-posts-section pf-reveal" id="pf-ig-posts-section">
      <!-- Tab Bar -->
      <div class="pf-ig-tabs">
        <button class="pf-ig-tab active" id="pf-ig-tab-posts" onclick="switchIgTab('posts')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
          Posts
        </button>
        <button class="pf-ig-tab" id="pf-ig-tab-reels" onclick="switchIgTab('reels')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="4"/><line x1="2" y1="8" x2="22" y2="8"/><line x1="8" y1="2" x2="8" y2="8"/><line x1="16" y1="2" x2="16" y2="8"/><polygon points="10,12 10,19 16,15.5" fill="currentColor" stroke="none"/></svg>
          Creator Series
        </button>
        <button class="pf-ig-tab" id="pf-ig-tab-tagged" onclick="switchIgTab('tagged')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Tagged
        </button>
      </div>
      <!-- Posts Grid -->
      <div class="pf-ig-grid" id="pf-ig-grid"></div>
    </section>

    <!-- Footer -->
    <footer class="pf-footer pf-reveal">
      <p class="pf-footer-text">Crafted on <span class="pf-footer-brand">Innovate Hub</span></p>
    </footer>
  </div>

  <!-- Add/Edit Project Modal -->
  <div class="pf-modal-overlay" id="pf-project-modal" onclick="if(event.target===this)closeProjectModal()">
    <div class="pf-modal">
      <div class="pf-modal-header">
        <h3 id="pf-modal-title">Add Project</h3>
        <button class="pf-modal-close" onclick="closeProjectModal()">&times;</button>
      </div>
      <div class="pf-modal-body">
        <input type="hidden" id="pf-edit-project-id">
        <div class="pf-form-group">
          <label>Project Name</label>
          <input type="text" class="pf-form-input" id="pf-project-name" placeholder="My Awesome Project">
        </div>
        <div class="pf-form-group">
          <label>Description</label>
          <textarea class="pf-form-input" id="pf-project-desc" placeholder="What does this project do?" rows="3"></textarea>
        </div>
        <div class="pf-form-group">
          <label>Technologies (comma separated)</label>
          <input type="text" class="pf-form-input" id="pf-project-tech" placeholder="React, Node.js, Python">
        </div>
        <div class="pf-form-group">
          <label>Project URL</label>
          <input type="text" class="pf-form-input" id="pf-project-url" placeholder="https://github.com/...">
        </div>
        <div class="pf-form-group">
          <label>Thumbnail URL (optional)</label>
          <input type="text" class="pf-form-input" id="pf-project-thumb" placeholder="https://example.com/image.png">
        </div>
      </div>
      <div class="pf-modal-footer">
        <button class="pf-btn pf-btn-secondary" onclick="closeProjectModal()">Cancel</button>
        <button class="pf-btn pf-btn-primary" onclick="saveProject()">Save Project</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="pf-modal-overlay" id="pf-edit-profile-modal" onclick="if(event.target===this)closeEditProfileModal()">
    <div class="pf-modal">
      <div class="pf-modal-header">
        <h3>Edit Profile</h3>
        <button class="pf-modal-close" onclick="closeEditProfileModal()">&times;</button>
      </div>
      <div class="pf-modal-body">
        <!-- Avatar Change -->
        <div class="pf-edit-avatar-section">
          <div class="pf-edit-avatar-wrap">
            <img id="pf-edit-avatar" class="pf-edit-avatar-img" src="" alt="Avatar">
            <button class="pf-edit-avatar-btn" onclick="changePhoto()">
              <i class="fas fa-camera"></i>
            </button>
          </div>
          <div class="pf-edit-change-photo" onclick="changePhoto()">
            <i class="fas fa-image"></i> Change Profile Photo
          </div>
        </div>
        <!-- Full Name -->
        <div class="pf-form-group">
          <label>Full Name</label>
          <input type="text" class="pf-form-input" id="pf-edit-fullname" placeholder="Your full name">
        </div>
        <!-- Username -->
        <div class="pf-form-group">
          <label>Username</label>
          <input type="text" class="pf-form-input" id="pf-edit-username" placeholder="Your username">
        </div>
        <!-- Bio -->
        <div class="pf-form-group">
          <label>Bio</label>
          <textarea class="pf-form-input" id="pf-edit-bio" placeholder="Tell the world about yourself..." rows="3" maxlength="150"></textarea>
          <div style="text-align:right;font-size:12px;color:var(--pf-text2);margin-top:4px;"><span id="pf-bio-count">0</span>/150</div>
        </div>
        <!-- Skills -->
        <div class="pf-form-group">
          <label>Skills</label>
          <input type="text" class="pf-form-input" id="pf-edit-skills" placeholder="JavaScript, Python, Design">
        </div>
        <!-- Interests -->
        <div class="pf-form-group">
          <label>Interests</label>
          <input type="text" class="pf-form-input" id="pf-edit-interests" placeholder="Gaming, Travel, Music">
        </div>
        <!-- Favorite Teams -->
        <div class="pf-form-group">
          <label>Favorite Teams</label>
          <input type="text" class="pf-form-input" id="pf-edit-teams" placeholder="Lakers, Real Madrid">
        </div>
      </div>
      <div class="pf-modal-footer">
        <button class="pf-btn pf-btn-secondary" onclick="closeEditProfileModal()">Cancel</button>
        <button class="pf-btn pf-btn-primary" onclick="saveEditProfile()">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Followers/Following List Modal -->
  <div class="pf-list-modal-overlay" id="pf-list-modal" onclick="if(event.target===this)closeListModal()">
    <div class="pf-list-modal">
      <div class="pf-list-modal-header">
        <h3 id="pf-list-title">Followers</h3>
        <button class="pf-modal-close" onclick="closeListModal()">&times;</button>
      </div>
      <div class="pf-list-modal-body" id="pf-list-body"></div>
    </div>
  </div>

  <!-- Settings Drawer -->
  <div class="pf-settings-overlay" id="pf-settings-overlay" onclick="closeSettingsDrawer()"></div>
  <div class="pf-settings-drawer" id="pf-settings-drawer">
    <div class="pf-settings-drawer-header">
      <h3>Settings</h3>
      <button class="pf-modal-close" onclick="closeSettingsDrawer()">&times;</button>
    </div>

    <!-- Account Section -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title">Account</div>
      <div class="pf-settings-item" onclick="openEditProfileModal()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-user-edit"></i></div>
          <div>
            <div class="pf-settings-item-label">Edit Profile</div>
            <div class="pf-settings-item-desc">Change your profile info</div>
          </div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
      <div class="pf-settings-item" onclick="changePhoto()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-camera"></i></div>
          <div>
            <div class="pf-settings-item-label">Change Photo</div>
            <div class="pf-settings-item-desc">Update your profile picture</div>
          </div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
      <div class="pf-settings-item" onclick="showSavedPosts()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-bookmark"></i></div>
          <div>
            <div class="pf-settings-item-label">Saved Posts</div>
            <div class="pf-settings-item-desc">View your saved posts</div>
          </div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
      <div class="pf-settings-item" onclick="showArchivedPosts()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-archive"></i></div>
          <div>
            <div class="pf-settings-item-label">Archived Posts</div>
            <div class="pf-settings-item-desc">View your archived posts</div>
          </div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
    </div>

    <!-- Appearance Section -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title">Appearance</div>
      <div class="pf-settings-item" onclick="toggleThemeSetting()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-moon"></i></div>
          <div>
            <div class="pf-settings-item-label">Dark Mode</div>
            <div class="pf-settings-item-desc">Toggle dark/light theme</div>
          </div>
        </div>
        <div class="pf-toggle active" id="pf-theme-toggle"></div>
      </div>
    </div>

    <!-- Privacy Section -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title">Privacy</div>
      <div class="pf-settings-item" onclick="toggleCrosspathSetting()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-location-crosshairs"></i></div>
          <div>
            <div class="pf-settings-item-label">Crosspath</div>
            <div class="pf-settings-item-desc">Allow others to find you nearby</div>
          </div>
        </div>
        <div class="pf-toggle" id="pf-crosspath-toggle"></div>
      </div>
      <div class="pf-settings-item" onclick="toggleOnlineStatusSetting()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-circle"></i></div>
          <div>
            <div class="pf-settings-item-label">Online Status</div>
            <div class="pf-settings-item-desc">Show when you're active</div>
          </div>
        </div>
        <div class="pf-toggle" id="pf-online-toggle"></div>
      </div>
    </div>

    <!-- Notifications Section -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title">Notifications</div>
      <div class="pf-settings-item" onclick="toggleNotificationsSetting()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-bell"></i></div>
          <div>
            <div class="pf-settings-item-label">Push Notifications</div>
            <div class="pf-settings-item-desc">Get notified about activity</div>
          </div>
        </div>
        <div class="pf-toggle active" id="pf-notif-toggle"></div>
      </div>
    </div>

    <!-- Security Section -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title">Security</div>
      <div class="pf-settings-item" onclick="changePasswordSetting()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-lock"></i></div>
          <div>
            <div class="pf-settings-item-label">Change Password</div>
          </div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
      <div class="pf-settings-item" onclick="viewBlockedUsers()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-ban"></i></div>
          <div>
            <div class="pf-settings-item-label">Blocked Users</div>
          </div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
    </div>

    <!-- Support Section -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title">Support</div>
      <div class="pf-settings-item" onclick="window.location.href='/about'">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-info-circle"></i></div>
          <div><div class="pf-settings-item-label">About</div></div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
      <div class="pf-settings-item" onclick="window.location.href='/help'">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon"><i class="fas fa-question-circle"></i></div>
          <div><div class="pf-settings-item-label">Help</div></div>
        </div>
        <span class="pf-settings-item-chevron"><i class="fas fa-chevron-right"></i></span>
      </div>
    </div>

    <!-- Danger Zone -->
    <div class="pf-settings-section">
      <div class="pf-settings-section-title" style="color:#ef4444;">Danger Zone</div>
      <div class="pf-settings-item" onclick="confirmLogout()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon" style="background:rgba(239,68,68,0.12);color:#ef4444;"><i class="fas fa-sign-out-alt"></i></div>
          <div><div class="pf-settings-item-label pf-danger-text">Log Out</div></div>
        </div>
      </div>
      <div class="pf-settings-item danger" onclick="confirmDeleteAccount()">
        <div class="pf-settings-item-left">
          <div class="pf-settings-item-icon" style="background:rgba(239,68,68,0.12);color:#ef4444;"><i class="fas fa-trash-alt"></i></div>
          <div>
            <div class="pf-settings-item-label pf-danger-text">Delete Account</div>
            <div class="pf-settings-item-desc">Permanently delete everything</div>
          </div>
        </div>
      </div>
    </div>

    <div style="padding:24px;text-align:center;">
      <p style="font-size:12px;color:var(--pf-text2);">Innovate Hub v2.0</p>
    </div>
  </div>

  <!-- Fullscreen Post/Reel Viewer (dynamically filled by JS, matches home feed ig-fullscreen-viewer) -->
  <div id="pf-fullscreen-anchor"></div>

  <!-- Post Actions Bottom Sheet (exact home feed structure) -->
  <div id="pfPostActionsModal" class="ig-modal-overlay" style="display: none;" onclick="closePfPostActions(event)">
    <div class="post-actions-sheet" onclick="event.stopPropagation()">
      <div class="post-actions-header">
        <div class="post-actions-handle"></div>
      </div>
      
      <div id="pfPostActionsViewer" style="display: none;">
        <div class="post-actions-list">
          <div class="post-action-item" onclick="pfHandleRepost()">
            <div class="action-icon">
              <svg fill="currentColor" viewBox="0 0 24 24"><path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
            </div>
            <span>Repost</span>
          </div>
          
          <div class="post-action-item" onclick="pfHandleGentleReminder()">
            <div class="action-icon">
              <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
            </div>
            <span>Gentle Reminder</span>
          </div>
          
          <div class="post-action-item danger" onclick="pfHandleReport()">
            <div class="action-icon">
              <svg fill="currentColor" viewBox="0 0 24 24"><path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z"/></svg>
            </div>
            <span>Report</span>
          </div>
        </div>
      </div>
      
      <div id="pfPostActionsOwner" style="display: none;">
        <div class="post-actions-list">
          <div class="post-action-item" onclick="pfHandleEditPost()">
            <div class="action-icon">
              <svg fill="currentColor" viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
            </div>
            <span>Edit Post</span>
          </div>
          
          <div class="post-action-item" onclick="pfHandleArchivePost()">
            <div class="action-icon">
              <svg fill="currentColor" viewBox="0 0 24 24"><path d="M20.54 5.23l-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27zM12 17.5L6.5 12H10v-2h4v2h3.5L12 17.5zM5.12 5l.81-1h12l.94 1H5.12z"/></svg>
            </div>
            <span>Archive</span>
          </div>
          
          <div class="post-action-item danger" onclick="pfHandleDeletePost()">
            <div class="action-icon">
              <svg fill="currentColor" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
            </div>
            <span>Delete</span>
          </div>
        </div>
      </div>
      
      <button class="post-actions-cancel" onclick="closePfPostActions()">Cancel</button>
    </div>
  </div>

  <!-- Gentle Reminder Modal (matches home feed) -->
  <div id="pfReminderModal" class="ig-modal-overlay" style="display: none;" onclick="pfCloseReminderModal(event)">
    <div class="ig-modal" onclick="event.stopPropagation()">
      <div class="ig-modal-header">Set Gentle Reminder</div>
      <div style="padding: 20px;">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--ig-primary-text);">Date & Time</label>
        <input type="datetime-local" id="pfReminderDate" class="ig-chat-input" style="width: 100%; padding: 10px; border: 1px solid var(--ig-border); border-radius: 8px;">
        
        <label style="display: block; margin: 16px 0 8px; font-weight: 500; color: var(--ig-primary-text);">Message (Optional)</label>
        <textarea id="pfReminderMessage" class="ig-chat-input" placeholder="Add a note for this reminder..." rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--ig-border); border-radius: 8px; resize: vertical;"></textarea>
      </div>
      <div class="ig-modal-item" onclick="pfSubmitReminder()" style="color: var(--ig-blue); font-weight: 600;">
        Set Reminder
      </div>
      <div class="ig-modal-item" onclick="pfCloseReminderModal()">
        Cancel
      </div>
    </div>
  </div>

  <!-- Edit Post Modal (exact copy from home feed) -->
  <div id="pfEditPostModal" class="cp-overlay" style="display: none;" onclick="pfCloseEditModal(event)">
    <div class="cp-container" onclick="event.stopPropagation()">
      <!-- Header -->
      <div class="cp-header">
        <button class="cp-header-btn" onclick="pfCloseEditModal()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
        <h2 class="cp-header-title">Edit Post</h2>
        <button class="cp-share-btn" onclick="pfSubmitEditPost()" id="pfEditShareBtn">Save</button>
      </div>

      <!-- Body -->
      <div class="cp-body">
        <!-- User Info Row -->
        <div class="cp-user-row">
          <img id="pfEditUserAvatar" src="" alt="" class="cp-avatar">
          <span class="cp-username" id="pfEditUsername"></span>
        </div>

        <!-- Caption -->
        <div class="cp-caption-wrap">
          <textarea id="pfEditPostContent" class="cp-caption" placeholder="Write the content or caption..." rows="4" oninput="pfOnEditCaptionInput(this)"></textarea>
          <div class="cp-char-count"><span id="pfEditCharCount">0</span> / 2,200</div>
        </div>

        <!-- Hashtag Suggestions -->
        <div id="pfEditHashtagSuggestions" class="cp-hashtag-suggestions" style="display: none;">
          <div class="cp-hashtag-header">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></svg>
            <span>Suggested Hashtags</span>
          </div>
          <div id="pfEditHashtagList" class="cp-hashtag-list"></div>
        </div>

        <!-- Trending Hashtags -->
        <div id="pfEditTrendingHashtags" class="cp-trending-section">
          <div class="cp-trending-header" onclick="pfToggleEditTrendingHashtags()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--ig-blue)" stroke-width="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>
            <span>Trending</span>
            <svg class="cp-trending-chevron" id="pfEditTrendingChevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
          <div id="pfEditTrendingList" class="cp-trending-list" style="display: none;"></div>
        </div>

        <!-- ===== POST-MODE MEDIA (shown when editing a regular Post) ===== -->
        <div id="pfEditPostMediaSection">
          <!-- Existing Media Preview -->
          <div id="pfEditExistingMedia" class="cp-media-grid"></div>

          <!-- New Media Preview -->
          <div id="pfEditNewMedia" class="cp-media-grid"></div>

          <!-- Existing Files -->
          <div id="pfEditExistingFiles" class="cp-files-list"></div>

          <!-- Upload Toolbar -->
          <div class="cp-toolbar">
            <label class="cp-tool-btn" title="Add Photos & Videos">
              <input type="file" id="pfEditPostImages" accept="image/*,video/*" multiple style="display: none;" onchange="pfPreviewEditMedia(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              <span class="cp-tool-label">Photo/Video</span>
            </label>
            <label class="cp-tool-btn" title="Attach Files">
              <input type="file" id="pfEditPostFiles" accept=".pdf,.doc,.docx,.txt,.zip,.xls,.xlsx,.ppt,.pptx" multiple style="display: none;" onchange="pfPreviewEditFiles(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"/></svg>
              <span class="cp-tool-label">Files</span>
            </label>
            <button class="cp-tool-btn" onclick="pfToggleEditPoll()" title="Create Poll" id="pfEditPollToggleBtn">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="6" height="18" rx="1"/><rect x="15" y="8" width="6" height="13" rx="1"/><rect x="9" y="11" width="6" height="10" rx="1"/></svg>
              <span class="cp-tool-label">Poll</span>
            </button>
            <button class="cp-tool-btn" onclick="pfToggleEditSchedule()" title="Schedule Post" id="pfEditScheduleToggleBtn">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              <span class="cp-tool-label">Schedule</span>
            </button>
          </div>
        </div>

        <!-- ===== CREATOR SERIES-MODE MEDIA (shown when editing a Creator Series) ===== -->
        <div id="pfEditCreatorSeriesSection" class="edit-cs-section" style="display: none;">
          <!-- Video Preview -->
          <div class="cr-cseries-preview" id="pfEditCsPreview">
            <div class="cr-cseries-video-wrap">
              <video id="pfEditCreatorSeriesVideo" class="cr-cseries-video" playsinline></video>
              <div class="cr-cseries-play-overlay" id="pfEditCsPlayOverlay" onclick="pfToggleEditCSPlayback()">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="white" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>
              </div>
              <div class="cr-cseries-duration" id="pfEditCreatorSeriesDuration">0:00</div>
              <label class="cr-cseries-change-btn">
                <input type="file" id="pfEditCreatorSeriesVideoInput" accept="video/*" style="display:none;" onchange="pfOnEditCSVideoChanged(this)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><polyline points="23 20 23 14 17 14"/><path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"/></svg>
                Change
              </label>
            </div>

            <!-- Trim Controls -->
            <div class="cr-trim-section">
              <div class="cr-trim-header">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--ig-blue)" stroke-width="2"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>
                <span>Trim Video</span>
              </div>
              <div class="cr-trim-timeline" id="pfEditCsTrimTimeline">
                <canvas id="pfEditCsTrimCanvas" class="cr-trim-canvas" height="48"></canvas>
                <div class="cr-trim-handle cr-trim-start" id="pfEditCsTrimStart"></div>
                <div class="cr-trim-handle cr-trim-end" id="pfEditCsTrimEnd"></div>
                <div class="cr-trim-progress" id="pfEditCsTrimProgress"></div>
              </div>
              <div class="cr-trim-times">
                <span id="pfEditCsTrimStartTime">0:00</span>
                <span id="pfEditCsTrimDurationLabel">Duration: 0:00</span>
                <span id="pfEditCsTrimEndTime">0:00</span>
              </div>
            </div>

            <!-- Cover Frame Selector -->
            <div class="cr-cover-section">
              <div class="cr-cover-header">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--ig-blue)" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                <span>Cover</span>
              </div>
              <div class="cr-cover-thumbnails" id="pfEditCsCoverThumbnails"></div>
              <div class="cr-cover-preview">
                <canvas id="pfEditCsCoverCanvas" class="cr-cover-canvas" width="120" height="213"></canvas>
                <p class="cr-cover-hint">Tap a frame above to set as cover</p>
              </div>
            </div>

            <!-- Audio Section -->
            <div class="cr-audio-section">
              <div class="cr-audio-header" onclick="pfToggleEditCSAudio()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
                <span>Audio</span>
                <svg class="cr-audio-chevron" id="pfEditCsAudioChevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
              </div>
              <div id="pfEditCsAudioOptions" class="cr-audio-options" style="display:none;">
                <label class="cp-toggle-row" style="padding: 8px 0;">
                  <div class="cp-toggle-info">
                    <span style="font-size: 13px;">🔇 Mute original audio</span>
                  </div>
                  <div class="cp-switch">
                    <input type="checkbox" id="pfEditCsMuteAudio">
                    <span class="cp-switch-slider"></span>
                  </div>
                </label>
                <div class="cr-audio-volume" id="pfEditCsVolumeSection">
                  <label class="cb-field-label">Volume</label>
                  <input type="range" id="pfEditCsAudioVolume" class="cr-volume-slider" min="0" max="100" value="100">
                  <span id="pfEditCsVolumeLabel" class="cr-volume-label">100%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Creator Series Toolbar -->
          <div class="cp-toolbar">
            <label class="cp-tool-btn" title="Change Video">
              <input type="file" accept="video/*" style="display:none;" onchange="pfOnEditCSVideoChanged(this)">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/></svg>
              <span class="cp-tool-label">Video</span>
            </label>
            <button class="cp-tool-btn" onclick="pfToggleEditPoll()" title="Create Poll">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="6" height="18" rx="1"/><rect x="15" y="8" width="6" height="13" rx="1"/><rect x="9" y="11" width="6" height="10" rx="1"/></svg>
              <span class="cp-tool-label">Poll</span>
            </button>
            <button class="cp-tool-btn" onclick="pfToggleEditSchedule()" title="Schedule">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              <span class="cp-tool-label">Schedule</span>
            </button>
          </div>
        </div>

        <!-- Poll Section -->
        <div id="pfEditPollSection" class="cp-section" style="display: none;">
          <div class="cp-section-header">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--ig-blue)" stroke-width="2"><rect x="3" y="3" width="6" height="18" rx="1"/><rect x="15" y="8" width="6" height="13" rx="1"/><rect x="9" y="11" width="6" height="10" rx="1"/></svg>
            <span>Create Poll</span>
            <button class="cp-section-close" onclick="pfToggleEditPoll()">×</button>
          </div>
          <input type="text" id="pfEditPollQuestion" class="cp-input" placeholder="Ask a question...">
          <div id="pfEditPollOptions" class="cp-poll-options">
            <div class="cp-poll-option-row"><span class="cp-poll-dot" style="background: #0095f6;"></span><input type="text" class="pf-edit-poll-option cp-input" placeholder="Option 1"></div>
            <div class="cp-poll-option-row"><span class="cp-poll-dot" style="background: #e1306c;"></span><input type="text" class="pf-edit-poll-option cp-input" placeholder="Option 2"></div>
          </div>
          <button class="cp-add-option-btn" onclick="pfAddEditPollOption()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Add option
          </button>
          <div class="cp-poll-expiry">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <input type="datetime-local" id="pfEditPollExpiry" class="cp-datetime-input">
            <span class="cp-expiry-label">Poll ends</span>
          </div>
        </div>

        <!-- Schedule Section -->
        <div id="pfEditScheduleSection" class="cp-section" style="display: none;">
          <div class="cp-section-header">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--ig-blue)" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            <span>Schedule Post</span>
            <button class="cp-section-close" onclick="pfToggleEditSchedule()">×</button>
          </div>
          <div class="cp-schedule-picker">
            <input type="datetime-local" id="pfEditScheduleTime" class="cp-datetime-input">
            <p class="cp-schedule-hint">Your post will be published at the scheduled time</p>
          </div>
        </div>

        <!-- Advanced Options -->
        <div class="cp-advanced-toggle" onclick="pfToggleEditAdvancedOptions()">
          <span>Advanced options</span>
          <svg id="pfEditAdvancedChevron" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div id="pfEditAdvancedOptions" class="cp-advanced" style="display: none;">
          <label class="cp-toggle-row">
            <div class="cp-toggle-info">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.42 19.42 0 01-6-6A19.79 19.79 0 012.12 4.18 2 2 0 014.11 2h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>
              <span>Contact Me Button</span>
            </div>
            <div class="cp-switch">
              <input type="checkbox" id="pfEditEnableContact">
              <span class="cp-switch-slider"></span>
            </div>
          </label>
          <label class="cp-toggle-row">
            <div class="cp-toggle-info">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
              <span>I'm Interested Button</span>
            </div>
            <div class="cp-switch">
              <input type="checkbox" id="pfEditEnableInterested">
              <span class="cp-switch-slider"></span>
            </div>
          </label>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/app.js"></script>
  <script src="/js/instagram-theme.js"></script>
  <script src="/js/post-interactions.js"></script>
  <script src="/js/post-renderer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  <script>
    // ===== Portfolio Page Logic =====
    const urlParams = new URLSearchParams(window.location.search);
    const viewUsername = urlParams.get('username');
    // Also support /profile/:id or /profile/:username URL pattern used throughout the app
    const pathMatch = window.location.pathname.match(/^\/profile\/(.+)$/);
    const pathParam = pathMatch ? decodeURIComponent(pathMatch[1]) : null;
    const viewUserId = pathParam && /^\d+$/.test(pathParam) ? parseInt(pathParam) : null;
    const viewUsernameFromPath = pathParam && !/^\d+$/.test(pathParam) ? pathParam : null;
    const currentUser = JSON.parse(localStorage.getItem('user') || '{}');

    // Initialize shared post interactions module
    PostInteractions.init({
      getUser: () => currentUser,
      refreshPosts: () => typeof loadRecentPosts === 'function' && loadRecentPosts(),
      prefix: 'pf'
    });

    // Initialize shared post renderer module
    PostRenderer.init({
      getUser: () => currentUser,
      refreshPosts: () => typeof loadRecentPosts === 'function' && loadRecentPosts(),
      getUserAvatar: (pic) => pic || defaultAvatar,
      linkifyCaption: (text) => PostRenderer.escapeHtml(text),
      openCommentsModal: (postId) => typeof openCommentsModal === 'function' && openCommentsModal(postId),
      sharePost: (postId) => typeof sharePost === 'function' && sharePost(postId),
      openPostActionsMenu: (postId, userId) => typeof openPostActionsMenu === 'function' && openPostActionsMenu(postId, userId),
      showAlert: (msg, type) => typeof showToast === 'function' && showToast(msg),
      apiRequest: async (url, opts) => {
        const res = await fetch('/api' + url, Object.assign({}, opts, {
          headers: Object.assign({ 'Authorization': 'Bearer ' + localStorage.getItem('token'), 'Content-Type': 'application/json' }, (opts && opts.headers) || {})
        }));
        if (!res.ok) throw new Error('Request failed');
        return res.json();
      },
    });

    // Open post in full-screen viewer (delegates to PostRenderer)
    function viewPost(postId) {
      var allPosts = allProfilePosts;
      var clickedPost = allPosts.find(function(p) { return p.id === postId; });

      var feedPosts;
      if (currentIgTab === 'reels' || (clickedPost && clickedPost.video_url)) {
        feedPosts = allPosts.filter(function(p) { return p.video_url; });
      } else {
        feedPosts = allPosts.filter(function(p) { return !p.video_url; });
        if (feedPosts.length === 0) feedPosts = allPosts;
      }

      var startIdx = feedPosts.findIndex(function(p) { return p.id === postId; });
      if (startIdx === -1) startIdx = 0;

      var orderedPosts = feedPosts.slice(startIdx).concat(feedPosts.slice(0, startIdx));
      PostRenderer.openFullScreenViewer(orderedPosts, 0, {
        viewerId: 'pfFullScreenViewer',
        contentId: 'pfFullScreenContent',
        idPrefix: 'pf-',
        showFollowBtn: true,
      });
    }


    let portfolioUserId = null;
    let isOwnPortfolio = false;
    let portfolioProjects = [];
    let portfolioUserData = null; // Store full user data for edit profile
    let isFollowing = false;

    const defaultAvatar = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23262645'/%3E%3Ccircle cx='50' cy='35' r='18' fill='%23667eea'/%3E%3Cpath d='M20 85 Q20 60 50 60 Q80 60 80 85 Z' fill='%23667eea'/%3E%3C/svg%3E";

    const interestIcons = {
      'gaming': '🎮', 'travel': '✈️', 'music': '🎵', 'cooking': '🍳', 'fitness': '💪',
      'reading': '📚', 'photography': '📸', 'art': '🎨', 'coding': '💻', 'movies': '🎬',
      'sports': '⚽', 'design': '🎯', 'tech': '🚀', 'science': '🔬', 'nature': '🌿',
      'fashion': '👗', 'food': '🍕', 'cars': '🏎️', 'anime': '🎌', 'writing': '✍️',
      'hiking': '🥾', 'yoga': '🧘', 'dance': '💃', 'crafts': '🛠️', 'gardening': '🌱',
      'default': '✨'
    };

    function goBack() {
      window.location.href = '/home';
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'pf-toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2500);
    }

    async function initPortfolio() {
      if (!localStorage.getItem('token')) {
        window.location.href = '/login';
        return;
      }

      try {
        let user;

        // Determine which user to view: ?username=, /profile/:id, /profile/:username, or self
        const effectiveUsername = viewUsername || viewUsernameFromPath;

        if (effectiveUsername) {
          // Viewing via username (query param or path)
          if (currentUser.username && effectiveUsername.toLowerCase() === currentUser.username.toLowerCase()) {
            portfolioUserId = currentUser.id;
            isOwnPortfolio = true;
          } else {
            const searchRes = await fetch(`/api/search/users?q=${encodeURIComponent(effectiveUsername)}`, {
              headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
            });
            const searchData = await searchRes.json();
            const found = searchData.users?.find(u => u.username.toLowerCase() === effectiveUsername.toLowerCase());

            if (!found) {
              alert('User not found');
              return goBack();
            }
            portfolioUserId = found.id;
            isOwnPortfolio = currentUser.id == found.id;
          }
        } else if (viewUserId) {
          // Viewing via /profile/:id URL path (numeric ID)
          portfolioUserId = viewUserId;
          isOwnPortfolio = currentUser.id == viewUserId;
        } else {
          portfolioUserId = currentUser.id;
          isOwnPortfolio = true;
        }

        // Load user profile
        const profileRes = await fetch(`/api/users/${portfolioUserId}`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!profileRes.ok) throw new Error('Failed to load profile');
        const profileData = await profileRes.json();
        user = profileData.user;
        portfolioUserData = user;
        isFollowing = !!user.is_following;

        // Parse JSON fields
        const skills = Array.isArray(user.skills) ? user.skills : (user.skills ? JSON.parse(user.skills) : []);
        const interests = Array.isArray(user.interests) ? user.interests : (user.interests ? JSON.parse(user.interests) : []);
        const teams = Array.isArray(user.favorite_teams) ? user.favorite_teams : (user.favorite_teams ? JSON.parse(user.favorite_teams) : []);

        // Populate hero
        document.getElementById('pf-avatar').src = user.profile_picture || defaultAvatar;
        document.getElementById('pf-name-user').textContent = user.fullname || user.username;
        document.getElementById('pf-title').textContent = skills.length > 0 ? skills.slice(0, 3).join(' • ') : 'Innovate Hub Member';
        document.getElementById('pf-bio').textContent = user.bio || 'Building amazing things on Innovate Hub';

        // Stats
        document.getElementById('pf-posts-count').textContent = user.post_count || 0;
        document.getElementById('pf-followers-count').textContent = user.followers_count || 0;
        document.getElementById('pf-following-count').textContent = user.following_count || 0;

        // Render action buttons
        renderActionButtons();

        // Show settings button and avatar overlay for own profile
        if (isOwnPortfolio) {
          document.getElementById('pf-settings-btn').style.display = '';
          document.getElementById('pf-avatar-overlay').style.display = '';
        }

        // Skills
        if (skills.length > 0) {
          document.getElementById('pf-skills-section').style.display = '';
          const skillsGrid = document.getElementById('pf-skills-grid');
          skillsGrid.innerHTML = skills.map(s =>
            `<div class="pf-skill-chip pf-3d-tilt"><span>${s}</span></div>`
          ).join('');
        }

        // Interests
        const allInterests = [...interests, ...teams];
        if (allInterests.length > 0) {
          document.getElementById('pf-interests-section').style.display = '';
          const interestsGrid = document.getElementById('pf-interests-grid');
          interestsGrid.innerHTML = allInterests.map(i => {
            const key = i.toLowerCase().replace(/[^a-z]/g, '');
            const icon = Object.keys(interestIcons).find(k => key.includes(k));
            return `<div class="pf-interest-card pf-3d-tilt">
              <span class="pf-interest-icon">${interestIcons[icon] || interestIcons.default}</span>
              <div class="pf-interest-name">${i}</div>
            </div>`;
          }).join('');
        }

        // Show add project button for own portfolio
        if (isOwnPortfolio) {
          document.getElementById('pf-add-project-btn').style.display = '';
        }

        // Load projects
        await loadProjects();

        // Load recent posts
        await loadRecentPosts();

        // Animate reveal
        initScrollReveal();
        initTilt3D();
        animateCounters();

        // Load settings state
        if (isOwnPortfolio) {
          loadSettingsState();
        }

      } catch (err) {
        console.error('Portfolio init error:', err);
      }
    }

    // ===== ACTION BUTTONS =====
    function renderActionButtons() {
      const container = document.getElementById('pf-action-buttons');
      if (isOwnPortfolio) {
        container.innerHTML = `
          <button class="pf-action-btn pf-action-btn-primary" onclick="openEditProfileModal()">
            <i class="fas fa-pen"></i> Edit Profile
          </button>
          <button class="pf-action-btn pf-action-btn-secondary" onclick="openSettingsDrawer()">
            <i class="fas fa-cog"></i> Settings
          </button>
          <button class="pf-action-btn pf-action-btn-secondary" onclick="sharePortfolio()">
            <i class="fas fa-share-alt"></i> Share
          </button>
        `;
      } else {
        container.innerHTML = `
          <button class="pf-action-btn ${isFollowing ? 'pf-action-btn-following' : 'pf-action-btn-follow'}" id="pf-follow-btn" onclick="toggleFollow()">
            <i class="fas ${isFollowing ? 'fa-user-check' : 'fa-user-plus'}"></i> ${isFollowing ? 'Following' : 'Follow'}
          </button>
          <button class="pf-action-btn pf-action-btn-secondary" onclick="messageUser()">
            <i class="fas fa-paper-plane"></i> Message
          </button>
          <button class="pf-action-btn pf-action-btn-secondary" onclick="sharePortfolio()">
            <i class="fas fa-share-alt"></i> Share
          </button>
        `;
      }
    }

    // ===== FOLLOW / UNFOLLOW =====
    async function toggleFollow() {
      try {
        const method = isFollowing ? 'DELETE' : 'POST';
        const res = await fetch(`/api/users/${portfolioUserId}/follow`, {
          method,
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        isFollowing = !isFollowing;

        // Update button
        const btn = document.getElementById('pf-follow-btn');
        btn.className = `pf-action-btn ${isFollowing ? 'pf-action-btn-following' : 'pf-action-btn-follow'}`;
        btn.innerHTML = `<i class="fas ${isFollowing ? 'fa-user-check' : 'fa-user-plus'}"></i> ${isFollowing ? 'Following' : 'Follow'}`;

        // Update follower count
        const countEl = document.getElementById('pf-followers-count');
        let count = parseInt(countEl.textContent) || 0;
        count += isFollowing ? 1 : -1;
        countEl.textContent = Math.max(0, count);

        showToast(isFollowing ? 'Following!' : 'Unfollowed');
      } catch (err) {
        console.error('Follow error:', err);
        showToast('Failed to update');
      }
    }

    function messageUser() {
      window.location.href = `/messages?user=${portfolioUserId}`;
    }

    // ===== AVATAR CLICK & PHOTO CHANGE =====
    function handleAvatarClick() {
      if (isOwnPortfolio) {
        changePhoto();
      } else {
        // Preview photo for other users
        const src = document.getElementById('pf-avatar').src;
        if (!src || src.includes('default') || src.startsWith('data:image/svg')) return;
        const modal = document.createElement('div');
        modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:99999;display:flex;align-items:center;justify-content:center;cursor:pointer;';
        modal.innerHTML = `
          <button onclick="this.parentElement.remove()" style="position:absolute;top:20px;right:20px;background:rgba(255,255,255,0.2);border:none;color:white;width:44px;height:44px;border-radius:50%;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;">&times;</button>
          <img src="${src}" style="max-width:90vw;max-height:85vh;object-fit:contain;border-radius:12px;">
        `;
        modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        document.body.appendChild(modal);
      }
    }

    let cropper = null;

    function changePhoto() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 5 * 1024 * 1024) {
            showToast('Image must be under 5MB');
            return;
          }
          showImageCropper(file);
        }
      };
      input.click();
    }

    function showImageCropper(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const modal = document.createElement('div');
        modal.id = 'pf-cropper-modal';
        modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:100000;display:flex;flex-direction:column;';
        modal.innerHTML = `
          <div style="padding:16px 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--pf-border);background:#14142b;">
            <button onclick="closeCropper()" style="background:none;border:none;color:var(--pf-text);font-size:15px;font-weight:600;cursor:pointer;">Cancel</button>
            <h3 style="margin:0;font-size:16px;font-weight:700;color:var(--pf-text);">Adjust Photo</h3>
            <button onclick="uploadCroppedImage()" style="background:none;border:none;color:var(--pf-accent);font-size:15px;font-weight:600;cursor:pointer;" id="pf-crop-done">Done</button>
          </div>
          <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:20px;overflow:hidden;">
            <img id="pf-crop-image" src="${e.target.result}" style="max-width:100%;max-height:calc(100vh - 160px);display:block;">
          </div>
          <div style="padding:16px;background:#14142b;border-top:1px solid var(--pf-border);display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
            <button onclick="rotateCropper(-90)" class="pf-btn pf-btn-secondary" style="padding:8px 16px;"><i class="fas fa-undo"></i> Rotate</button>
            <button onclick="rotateCropper(90)" class="pf-btn pf-btn-secondary" style="padding:8px 16px;"><i class="fas fa-redo"></i> Rotate</button>
            <button onclick="flipCropper()" class="pf-btn pf-btn-secondary" style="padding:8px 16px;"><i class="fas fa-arrows-alt-h"></i> Flip</button>
            <button onclick="resetCropper()" class="pf-btn pf-btn-secondary" style="padding:8px 16px;"><i class="fas fa-sync"></i> Reset</button>
          </div>
        `;
        document.body.appendChild(modal);

        const image = document.getElementById('pf-crop-image');
        cropper = new Cropper(image, {
          aspectRatio: 1,
          viewMode: 1,
          dragMode: 'move',
          autoCropArea: 1,
          restore: false,
          guides: true,
          center: true,
          highlight: false,
          cropBoxMovable: true,
          cropBoxResizable: true,
          toggleDragModeOnDblclick: false,
        });
      };
      reader.readAsDataURL(file);
    }

    function closeCropper() {
      const modal = document.getElementById('pf-cropper-modal');
      if (modal) {
        if (cropper) { cropper.destroy(); cropper = null; }
        modal.remove();
      }
    }

    function rotateCropper(deg) { if (cropper) cropper.rotate(deg); }
    function flipCropper() { if (cropper) cropper.scaleX(-cropper.getData().scaleX || -1); }
    function resetCropper() { if (cropper) cropper.reset(); }

    async function uploadCroppedImage() {
      if (!cropper) return;
      const doneBtn = document.getElementById('pf-crop-done');
      doneBtn.disabled = true;
      doneBtn.textContent = 'Uploading...';

      try {
        const canvas = cropper.getCroppedCanvas({
          width: 400, height: 400,
          imageSmoothingEnabled: true,
          imageSmoothingQuality: 'high',
        });

        canvas.toBlob(async (blob) => {
          const formData = new FormData();
          formData.append('profile_picture', blob, 'profile.jpg');

          const response = await fetch('/api/users/profile-picture', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` },
            body: formData
          });

          if (!response.ok) throw new Error('Upload failed');
          const data = await response.json();

          // Update all avatar instances
          document.getElementById('pf-avatar').src = data.profile_picture;
          const editAvatar = document.getElementById('pf-edit-avatar');
          if (editAvatar) editAvatar.src = data.profile_picture;

          // Update stored user data
          const storedUser = JSON.parse(localStorage.getItem('user'));
          storedUser.profile_picture = data.profile_picture;
          localStorage.setItem('user', JSON.stringify(storedUser));

          closeCropper();
          showToast('Profile photo updated!');
        }, 'image/jpeg', 0.9);
      } catch (err) {
        console.error('Upload error:', err);
        showToast('Failed to upload photo');
        doneBtn.disabled = false;
        doneBtn.textContent = 'Done';
      }
    }

    // ===== EDIT PROFILE MODAL =====
    function openEditProfileModal() {
      closeSettingsDrawer();
      const user = portfolioUserData;
      if (!user) return;

      const skills = Array.isArray(user.skills) ? user.skills : (user.skills ? JSON.parse(user.skills) : []);
      const interests = Array.isArray(user.interests) ? user.interests : (user.interests ? JSON.parse(user.interests) : []);
      const teams = Array.isArray(user.favorite_teams) ? user.favorite_teams : (user.favorite_teams ? JSON.parse(user.favorite_teams) : []);

      document.getElementById('pf-edit-avatar').src = user.profile_picture || defaultAvatar;
      document.getElementById('pf-edit-fullname').value = user.fullname || '';
      document.getElementById('pf-edit-username').value = user.username || '';
      document.getElementById('pf-edit-bio').value = user.bio || '';
      document.getElementById('pf-edit-skills').value = skills.join(', ');
      document.getElementById('pf-edit-interests').value = interests.join(', ');
      document.getElementById('pf-edit-teams').value = teams.join(', ');
      updateBioCount();
      document.getElementById('pf-edit-profile-modal').style.display = 'flex';
    }

    function closeEditProfileModal() {
      document.getElementById('pf-edit-profile-modal').style.display = 'none';
    }

    function updateBioCount() {
      const bio = document.getElementById('pf-edit-bio');
      const count = document.getElementById('pf-bio-count');
      if (bio && count) count.textContent = bio.value.length;
    }

    document.getElementById('pf-edit-bio')?.addEventListener('input', updateBioCount);

    async function saveEditProfile() {
      try {
        const formData = new FormData();
        formData.append('fullname', document.getElementById('pf-edit-fullname').value);
        formData.append('username', document.getElementById('pf-edit-username').value);
        formData.append('bio', document.getElementById('pf-edit-bio').value);
        formData.append('skills', JSON.stringify(
          document.getElementById('pf-edit-skills').value.split(',').map(s => s.trim()).filter(s => s)
        ));
        formData.append('interests', JSON.stringify(
          document.getElementById('pf-edit-interests').value.split(',').map(i => i.trim()).filter(i => i)
        ));
        formData.append('favorite_teams', JSON.stringify(
          document.getElementById('pf-edit-teams').value.split(',').map(t => t.trim()).filter(t => t)
        ));

        const response = await fetch('/api/users', {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` },
          body: formData
        });

        if (!response.ok) throw new Error('Failed to update profile');

        closeEditProfileModal();
        showToast('Profile updated!');

        // Reload portfolio data
        await initPortfolio();
      } catch (err) {
        console.error('Save profile error:', err);
        showToast('Failed to update profile');
      }
    }

    // ===== SETTINGS DRAWER =====
    function openSettingsDrawer() {
      document.getElementById('pf-settings-overlay').classList.add('active');
      document.getElementById('pf-settings-drawer').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeSettingsDrawer() {
      document.getElementById('pf-settings-overlay').classList.remove('active');
      document.getElementById('pf-settings-drawer').classList.remove('active');
      document.body.style.overflow = '';
    }

    function loadSettingsState() {
      // Theme - always dark in portfolio but sync toggle state
      const theme = localStorage.getItem('theme') || 'dark';
      if (theme === 'dark') {
        document.getElementById('pf-theme-toggle').classList.add('active');
      } else {
        document.getElementById('pf-theme-toggle').classList.remove('active');
      }

      // Crosspath
      if (localStorage.getItem('crosspath_enabled') === 'true') {
        document.getElementById('pf-crosspath-toggle').classList.add('active');
      }

      // Online status
      if (localStorage.getItem('show_online_status') !== 'false') {
        document.getElementById('pf-online-toggle').classList.add('active');
      }

      // Notifications
      if (localStorage.getItem('notifications_enabled') !== 'false') {
        document.getElementById('pf-notif-toggle').classList.add('active');
      }
    }

    function toggleThemeSetting() {
      const toggle = document.getElementById('pf-theme-toggle');
      toggle.classList.toggle('active');
      const isDark = toggle.classList.contains('active');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      if (typeof igTheme !== 'undefined') igTheme.setTheme(isDark ? 'dark' : 'light');
      showToast(`${isDark ? 'Dark' : 'Light'} mode enabled`);
    }

    async function toggleCrosspathSetting() {
      const toggle = document.getElementById('pf-crosspath-toggle');
      const isEnabled = toggle.classList.contains('active');
      toggle.classList.toggle('active');
      localStorage.setItem('crosspath_enabled', !isEnabled);
      showToast(`Crosspath ${!isEnabled ? 'enabled' : 'disabled'}`);
    }

    async function toggleOnlineStatusSetting() {
      const toggle = document.getElementById('pf-online-toggle');
      const isEnabled = toggle.classList.contains('active');

      try {
        await fetch('/api/users/online-status', {
          method: 'PUT',
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ is_online: !isEnabled })
        });
        toggle.classList.toggle('active');
        localStorage.setItem('show_online_status', !isEnabled);
        showToast(`Online status ${!isEnabled ? 'visible' : 'hidden'}`);
      } catch (err) {
        showToast('Failed to update');
      }
    }

    function toggleNotificationsSetting() {
      const toggle = document.getElementById('pf-notif-toggle');
      const isEnabled = toggle.classList.contains('active');
      toggle.classList.toggle('active');
      localStorage.setItem('notifications_enabled', !isEnabled);
      showToast(`Notifications ${!isEnabled ? 'enabled' : 'disabled'}`);
    }

    function changePasswordSetting() {
      closeSettingsDrawer();
      const oldPw = prompt('Enter current password:');
      if (!oldPw) return;
      const newPw = prompt('Enter new password:');
      if (!newPw) return;
      const confirmPw = prompt('Confirm new password:');
      if (newPw !== confirmPw) { showToast('Passwords do not match'); return; }

      fetch('/api/users/password', {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ old_password: oldPw, new_password: newPw })
      })
      .then(res => {
        if (!res.ok) throw new Error('Failed');
        showToast('Password changed!');
      })
      .catch(() => showToast('Failed to change password'));
    }

    async function viewBlockedUsers() {
      closeSettingsDrawer();
      try {
        const res = await fetch('/api/users/blocked/list', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        const data = await res.json();
        const users = data.blocked_users || [];

        document.getElementById('pf-list-title').textContent = 'Blocked Users';
        const body = document.getElementById('pf-list-body');
        if (users.length === 0) {
          body.innerHTML = '<div style="padding:40px;text-align:center;color:var(--pf-text2);">No blocked users</div>';
        } else {
          body.innerHTML = users.map(u => `
            <div class="pf-user-list-item">
              <img class="pf-user-list-avatar" src="${u.profile_picture || defaultAvatar}" alt="${u.username}">
              <div style="flex:1;min-width:0;">
                <div class="pf-user-list-name">${u.username}</div>
              </div>
              <button onclick="unblockUser(${u.id}, this)" style="background:linear-gradient(135deg,var(--pf-accent),var(--pf-accent2));color:white;border:none;padding:6px 14px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;">Unblock</button>
            </div>
          `).join('');
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        showToast('Failed to load blocked users');
      }
    }

    async function unblockUser(userId, btn) {
      try {
        await fetch(`/api/users/${userId}/block`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        btn.closest('.pf-user-list-item').remove();
        showToast('User unblocked');
      } catch (err) {
        showToast('Failed to unblock');
      }
    }

    function confirmLogout() {
      closeSettingsDrawer();
      if (confirm('Log out of Innovate Hub?')) {
        fetch('/api/auth/logout', {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        }).finally(() => {
          localStorage.clear();
          window.location.href = '/';
        });
      }
    }

    function confirmDeleteAccount() {
      closeSettingsDrawer();
      if (!confirm('Are you sure? This cannot be undone.')) return;
      const password = prompt('Enter your password to confirm:');
      if (!password) return;

      fetch('/api/users/account', {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('token')}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ password })
      }).then(res => {
        if (!res.ok) throw new Error('Failed');
        localStorage.clear();
        window.location.href = '/';
      }).catch(() => showToast('Failed to delete account'));
    }

    // ===== FOLLOWERS / FOLLOWING LISTS =====
    function showFollowersList() {
      showFollowersDetailed();
    }

    function showFollowingList() {
      showFollowingDetailed();
    }

    async function showFollowersDetailed() {
      try {
        const res = await fetch(`/api/users/${portfolioUserId}/followers-detailed`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) {
          // Fallback to basic endpoint
          return showUserList('Followers', `/api/users/${portfolioUserId}/followers`, 'followers');
        }
        const data = await res.json();
        const users = data.followers || [];

        document.getElementById('pf-list-title').textContent = 'Followers';
        const body = document.getElementById('pf-list-body');

        if (users.length === 0) {
          body.innerHTML = `<div style="padding:48px;text-align:center;color:var(--pf-text2);"><i class="fas fa-users" style="font-size:32px;opacity:0.2;display:block;margin-bottom:12px;"></i>No followers yet</div>`;
        } else {
          body.innerHTML = users.map(u => {
            const isFollowingBack = u.is_following_back > 0;
            return `
            <div class="pf-user-list-item" style="cursor:default;">
              <a href="/profile.html?username=${u.username}" style="display:flex;align-items:center;gap:14px;flex:1;min-width:0;text-decoration:none;color:inherit;">
                <img class="pf-user-list-avatar" src="${u.profile_picture || defaultAvatar}" alt="${u.username}">
                <div style="flex:1;min-width:0;">
                  <div class="pf-user-list-name">${u.username}</div>
                  ${u.bio ? `<div class="pf-user-list-bio">${u.bio}</div>` : ''}
                </div>
              </a>
              <div class="pf-user-list-actions">
                ${u.id !== currentUser.id ? `
                  <button class="pf-follow-back-btn ${isFollowingBack ? 'following' : ''}" onclick="event.stopPropagation(); toggleFollowInList(${u.id}, this)">
                    ${isFollowingBack ? 'Following' : 'Follow Back'}
                  </button>
                ` : ''}
                ${isOwnPortfolio && u.id !== currentUser.id ? `
                  <button class="pf-remove-btn" onclick="event.stopPropagation(); removeFollower(${u.id}, this)" title="Remove follower">
                    <i class="fas fa-times"></i>
                  </button>
                ` : ''}
              </div>
            </div>`;
          }).join('');
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        console.error('List load error:', err);
        showToast('Failed to load followers');
      }
    }

    async function showFollowingDetailed() {
      try {
        const res = await fetch(`/api/users/${portfolioUserId}/following-detailed`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) {
          return showUserList('Following', `/api/users/${portfolioUserId}/following`, 'following');
        }
        const data = await res.json();
        const users = data.following || [];

        document.getElementById('pf-list-title').textContent = 'Following';
        const body = document.getElementById('pf-list-body');

        if (users.length === 0) {
          body.innerHTML = `<div style="padding:48px;text-align:center;color:var(--pf-text2);"><i class="fas fa-users" style="font-size:32px;opacity:0.2;display:block;margin-bottom:12px;"></i>Not following anyone yet</div>`;
        } else {
          body.innerHTML = users.map(u => `
            <div class="pf-user-list-item" style="cursor:default;">
              <a href="/profile.html?username=${u.username}" style="display:flex;align-items:center;gap:14px;flex:1;min-width:0;text-decoration:none;color:inherit;">
                <img class="pf-user-list-avatar" src="${u.profile_picture || defaultAvatar}" alt="${u.username}">
                <div style="flex:1;min-width:0;">
                  <div class="pf-user-list-name">${u.username}</div>
                  ${u.bio ? `<div class="pf-user-list-bio">${u.bio}</div>` : ''}
                </div>
              </a>
              <div class="pf-user-list-actions">
                <button class="pf-message-btn" onclick="event.stopPropagation(); window.location.href='/messages?user=${u.id}'">
                  Message
                </button>
                <div class="pf-more-btn" onclick="event.stopPropagation(); toggleFollowingMenu(this, ${u.id}, '${u.username}')">
                  <i class="fas fa-ellipsis-v"></i>
                </div>
              </div>
            </div>
          `).join('');
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        console.error('List load error:', err);
        showToast('Failed to load following');
      }
    }

    function toggleFollowingMenu(btn, userId, username) {
      // Close any existing dropdown
      document.querySelectorAll('.pf-dropdown-menu').forEach(m => m.remove());

      const menu = document.createElement('div');
      menu.className = 'pf-dropdown-menu';
      menu.innerHTML = `
        <button class="pf-dropdown-item danger" onclick="unfollowFromList(${userId}, this)">
          <i class="fas fa-user-minus"></i> Unfollow
        </button>
        <button class="pf-dropdown-item" onclick="muteUser(${userId}, '${username}', this)">
          <i class="fas fa-volume-mute"></i> Mute
        </button>
      `;
      btn.appendChild(menu);

      // Close on outside click
      const closeMenu = (e) => {
        if (!menu.contains(e.target) && e.target !== btn) {
          menu.remove();
          document.removeEventListener('click', closeMenu);
        }
      };
      setTimeout(() => document.addEventListener('click', closeMenu), 10);
    }

    async function toggleFollowInList(userId, btn) {
      const isFollowing = btn.classList.contains('following');
      try {
        const method = isFollowing ? 'DELETE' : 'POST';
        const res = await fetch(`/api/users/${userId}/follow`, {
          method,
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        btn.classList.toggle('following');
        btn.textContent = btn.classList.contains('following') ? 'Following' : 'Follow Back';
        showToast(btn.classList.contains('following') ? 'Following!' : 'Unfollowed');
      } catch (err) {
        showToast('Failed to update');
      }
    }

    async function removeFollower(userId, btn) {
      if (!confirm('Remove this follower?')) return;
      try {
        const res = await fetch(`/api/users/${userId}/remove-follower`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        btn.closest('.pf-user-list-item').remove();
        // Decrease follower count
        const countEl = document.getElementById('pf-followers-count');
        let count = parseInt(countEl.textContent) || 0;
        countEl.textContent = Math.max(0, count - 1);
        showToast('Follower removed');
      } catch (err) {
        showToast('Failed to remove follower');
      }
    }

    async function unfollowFromList(userId, btn) {
      try {
        const res = await fetch(`/api/users/${userId}/follow`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        const item = btn.closest('.pf-user-list-item');
        if (item) item.remove();
        const countEl = document.getElementById('pf-following-count');
        let count = parseInt(countEl.textContent) || 0;
        countEl.textContent = Math.max(0, count - 1);
        showToast('Unfollowed');
      } catch (err) {
        showToast('Failed to unfollow');
      }
    }

    async function muteUser(userId, username, btn) {
      try {
        const res = await fetch(`/api/users/${userId}/mute`, {
          method: 'POST',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        // Close dropdown
        const menu = btn.closest('.pf-dropdown-menu');
        if (menu) menu.remove();
        showToast(`${username} muted`);
      } catch (err) {
        showToast('Failed to mute user');
      }
    }

    async function showUserList(title, endpoint, key) {
      try {
        const res = await fetch(endpoint, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        const data = await res.json();
        const users = data[key] || [];

        document.getElementById('pf-list-title').textContent = title;
        const body = document.getElementById('pf-list-body');

        if (users.length === 0) {
          body.innerHTML = `<div style="padding:48px;text-align:center;color:var(--pf-text2);"><i class="fas fa-users" style="font-size:32px;opacity:0.2;display:block;margin-bottom:12px;"></i>No ${title.toLowerCase()} yet</div>`;
        } else {
          body.innerHTML = users.map(u => `
            <a class="pf-user-list-item" href="/profile.html?username=${u.username}">
              <img class="pf-user-list-avatar" src="${u.profile_picture || defaultAvatar}" alt="${u.username}">
              <div style="flex:1;min-width:0;">
                <div class="pf-user-list-name">${u.username}</div>
                ${u.bio ? `<div class="pf-user-list-bio">${u.bio}</div>` : ''}
              </div>
            </a>
          `).join('');
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        console.error('List load error:', err);
        showToast('Failed to load list');
      }
    }

    function closeListModal() {
      document.getElementById('pf-list-modal').style.display = 'none';
    }

    // ===== PORTFOLIO PROJECTS (existing) =====
    async function loadProjects() {
      try {
        const res = await fetch(`/api/portfolio/${portfolioUserId}/projects`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) {
          portfolioProjects = [];
        } else {
          const data = await res.json();
          portfolioProjects = data.projects || [];
        }
      } catch {
        portfolioProjects = [];
      }

      renderProjects();
    }

    function renderProjects() {
      const grid = document.getElementById('pf-projects-grid');
      document.getElementById('pf-projects-count').textContent = portfolioProjects.length;

      if (portfolioProjects.length === 0 && !isOwnPortfolio) {
        grid.innerHTML = `<div class="pf-empty" style="grid-column:1/-1;">
          <i class="fas fa-folder-open"></i>
          <h3>No projects yet</h3>
          <p>This user hasn't added any projects to their portfolio.</p>
        </div>`;
        return;
      }

      let html = '';
      portfolioProjects.forEach(p => {
        const tags = p.technologies ? p.technologies.split(',').map(t => t.trim()).filter(t => t) : [];
        html += `<div class="pf-project-card pf-3d-tilt" onclick="openProjectUrl('${p.url || '#'}')">
          ${p.thumbnail
            ? `<img class="pf-project-thumb" src="${p.thumbnail}" alt="${p.name}" onerror="this.outerHTML='<div class=\\'pf-project-thumb-placeholder\\'><i class=\\'fas fa-code\\'></i></div>'">`
            : `<div class="pf-project-thumb-placeholder"><i class="fas fa-code"></i></div>`
          }
          <div class="pf-project-body">
            <div class="pf-project-title">${p.name}</div>
            <div class="pf-project-desc">${p.description || 'No description'}</div>
            ${tags.length > 0 ? `<div class="pf-project-tags">${tags.map(t => `<span class="pf-project-tag">${t}</span>`).join('')}</div>` : ''}
            <div class="pf-project-footer">
              ${p.url ? `<a href="${p.url}" target="_blank" class="pf-project-link" onclick="event.stopPropagation()">View Project <i class="fas fa-arrow-right"></i></a>` : '<span></span>'}
              ${isOwnPortfolio ? `<div style="display:flex;gap:8px;">
                <button onclick="event.stopPropagation();editProject(${p.id})" style="background:none;border:none;color:var(--pf-text2);cursor:pointer;font-size:14px;" title="Edit"><i class="fas fa-pen"></i></button>
                <button onclick="event.stopPropagation();deleteProject(${p.id})" style="background:none;border:none;color:#ef4444;cursor:pointer;font-size:14px;" title="Delete"><i class="fas fa-trash"></i></button>
              </div>` : `<span class="pf-project-date">${p.created_at ? new Date(p.created_at).toLocaleDateString() : ''}</span>`}
            </div>
          </div>
        </div>`;
      });

      if (isOwnPortfolio) {
        html += `<div class="pf-project-add" onclick="openProjectModal()">
          <i class="fas fa-plus-circle"></i>
          <span>Add a project</span>
        </div>`;
      }

      grid.innerHTML = html;
      initTilt3D();
    }

    function openProjectUrl(url) {
      if (url && url !== '#') window.open(url, '_blank');
    }


    // Carousel navigation in fullscreen
    var pfFsCarouselIdx = {};

    // Close fullscreen viewer

    // Video autoplay with IntersectionObserver

    // Seek video via progress bar

    // Mute/unmute toggle

    // Single tap / double-tap handler for videos
    var _pfTapTimer = null;

    // Double-tap like with heart animation

    // Toggle like

    // Toggle save

    // Share post

    // ===== COMMENTS BOTTOM SHEET (matches home feed) =====


    // Follow user

    // Expand/collapse caption

    document.addEventListener('pointerdown', function(e) {
      var container = e.target.closest('.ig-cseries-progress-bar-container');
      if (!container || !document.getElementById('pfFullScreenViewer')) return;
      e.preventDefault();
      pfSeekVideo(container, e);
      var onMove = function(me) { me.preventDefault(); pfSeekVideo(container, me); };
      var onUp = function() { document.removeEventListener('pointermove', onMove); document.removeEventListener('pointerup', onUp); };
      document.addEventListener('pointermove', onMove);
      document.addEventListener('pointerup', onUp);
    });

    // Store all loaded posts for tabs
    let allProfilePosts = [];
    let currentIgTab = 'posts';

    async function loadRecentPosts() {
      try {
        const res = await fetch(`/api/users/${portfolioUserId}/posts`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) return;
        const data = await res.json();
        allProfilePosts = data.posts || [];
        renderIgGrid('posts');
      } catch (err) {
        console.error('Error loading posts:', err);
      }
    }

    function switchIgTab(tab) {
      currentIgTab = tab;
      document.querySelectorAll('.pf-ig-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('pf-ig-tab-' + tab).classList.add('active');
      renderIgGrid(tab);
    }

    function renderIgGrid(tab) {
      const grid = document.getElementById('pf-ig-grid');
      if (!grid) return;
      let posts = [];

      if (tab === 'posts') {
        posts = allProfilePosts.filter(p => !p.video_url);
      } else if (tab === 'reels') {
        posts = allProfilePosts.filter(p => p.video_url);
      } else if (tab === 'tagged') {
        posts = [];
      }

      if (posts.length === 0) {
        const emptyIcons = { posts: 'fa-camera', reels: 'fa-play-circle', tagged: 'fa-user-tag' };
        const emptyTitles = { posts: 'No Posts Yet', reels: 'No Creator Series Yet', tagged: 'No Tagged Posts' };
        const emptyDescs = {
          posts: isOwnPortfolio ? 'Share photos and videos to see them here.' : 'No posts to show.',
          reels: isOwnPortfolio ? 'Create creator series to see them here.' : 'No creator series to show.',
          tagged: isOwnPortfolio ? "When people tag you in photos, they'll appear here." : 'No tagged posts.'
        };
        grid.innerHTML = '<div class="pf-ig-empty"><div class="pf-ig-empty-icon"><i class="fas ' + emptyIcons[tab] + '"></i></div><h3>' + emptyTitles[tab] + '</h3><p>' + emptyDescs[tab] + '</p></div>';
        return;
      }

      grid.innerHTML = posts.map(function(p) {
        var images = Array.isArray(p.images) ? p.images : [];
        var likes = p.likes_count || 0;
        var comments = p.comments_count || 0;
        var hasMultiple = images.length > 1;
        var hasVideo = !!p.video_url;

        return '<div class="pf-ig-grid-item" onclick="viewPost(' + p.id + ')">'
          + (images.length > 0
            ? '<img src="' + images[0] + '" alt="Post" loading="lazy" onerror="this.style.display=\'none\'">'
            : hasVideo
              ? '<div style="width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;"><video src="' + p.video_url + '" style="width:100%;height:100%;object-fit:cover;" muted></video></div>'
              : '<div class="pf-ig-grid-text">' + (p.content || 'Post').substring(0, 100) + '</div>')
          + (hasMultiple ? '<span class="pf-ig-grid-multi"><i class="fas fa-clone"></i></span>' : '')
          + (hasVideo ? '<span class="pf-ig-grid-video"><i class="fas fa-play"></i></span>' : '')
          + '<div class="pf-ig-grid-overlay">'
          + '<span class="pf-ig-grid-stat"><i class="fas fa-heart"></i> ' + likes + '</span>'
          + '<span class="pf-ig-grid-stat"><i class="fas fa-comment"></i> ' + comments + '</span>'
          + '</div></div>';
      }).join('');
    }

    // ===== SHOW ALL POSTS (Instagram Grid) =====
    async function showAllPosts() {
      try {
        const res = await fetch(`/api/users/${portfolioUserId}/posts`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        const data = await res.json();
        const posts = data.posts || [];

        document.getElementById('pf-list-title').textContent = 'Posts';
        const body = document.getElementById('pf-list-body');

        if (posts.length === 0) {
          body.innerHTML = `<div style="padding:48px;text-align:center;color:var(--pf-text2);"><i class="fas fa-camera" style="font-size:40px;opacity:0.2;display:block;margin-bottom:12px;"></i><h3 style="margin-bottom:8px;color:var(--pf-text);">No Posts Yet</h3><p>Posts will appear here.</p></div>`;
        } else {
          body.innerHTML = `<div class="pf-ig-grid">${posts.map(p => {
            const images = Array.isArray(p.images) ? p.images : [];
            const likes = p.likes_count || 0;
            const comments = p.comments_count || 0;
            return `<div class="pf-ig-grid-item" onclick="viewPost(${p.id})">
              ${images.length > 0
                ? `<img src="${images[0]}" alt="Post" loading="lazy" onerror="this.style.display='none'">`
                : p.video_url
                  ? `<div style="width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;"><i class="fas fa-play-circle" style="font-size:32px;color:rgba(255,255,255,0.6);"></i></div>`
                  : `<div class="pf-ig-grid-text">${(p.content || 'Post').substring(0, 80)}</div>`
              }
              ${images.length > 1 ? '<span class="pf-ig-grid-multi"><i class="fas fa-clone"></i></span>' : ''}
              ${p.video_url ? '<span class="pf-ig-grid-video"><i class="fas fa-play"></i></span>' : ''}
              <div class="pf-ig-grid-overlay">
                <span class="pf-ig-grid-stat"><i class="fas fa-heart"></i> ${likes}</span>
                <span class="pf-ig-grid-stat"><i class="fas fa-comment"></i> ${comments}</span>
              </div>
            </div>`;
          }).join('')}</div>`;
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        showToast('Failed to load posts');
      }
    }

    // ===== ARCHIVED POSTS =====
    async function showArchivedPosts() {
      closeSettingsDrawer();
      try {
        const res = await fetch('/api/posts/archived/list', {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        const data = await res.json();
        const posts = data.posts || [];

        document.getElementById('pf-list-title').textContent = 'Archived Posts';
        const body = document.getElementById('pf-list-body');

        if (posts.length === 0) {
          body.innerHTML = `<div style="padding:48px;text-align:center;color:var(--pf-text2);"><i class="fas fa-archive" style="font-size:40px;opacity:0.2;display:block;margin-bottom:12px;"></i><h3 style="margin-bottom:8px;color:var(--pf-text);">No Archived Posts</h3><p>Archived posts will appear here.</p></div>`;
        } else {
          body.innerHTML = posts.map(p => {
            const images = Array.isArray(p.images) ? p.images : [];
            return `
            <div class="pf-user-list-item" style="cursor:default;">
              <div style="width:56px;height:56px;border-radius:8px;overflow:hidden;flex-shrink:0;background:var(--pf-card-bg);">
                ${images.length > 0
                  ? `<img src="${images[0]}" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display='none'">`
                  : `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;"><i class="fas fa-file-alt" style="color:var(--pf-text2);"></i></div>`
                }
              </div>
              <div style="flex:1;min-width:0;">
                <div class="pf-user-list-name">${(p.content || 'Post').substring(0, 40)}${(p.content || '').length > 40 ? '...' : ''}</div>
                <div class="pf-user-list-bio">${formatTimeAgo(p.created_at)} · ${p.likes_count || 0} likes · ${p.comments_count || 0} comments</div>
              </div>
              <div class="pf-user-list-actions">
                <button class="pf-follow-back-btn" onclick="event.stopPropagation(); unarchivePost(${p.id}, this)" style="background:linear-gradient(135deg,var(--pf-accent),var(--pf-accent2));">
                  <i class="fas fa-undo" style="margin-right:4px;"></i> Unarchive
                </button>
              </div>
            </div>`;
          }).join('');
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        showToast('Failed to load archived posts');
      }
    }

    async function unarchivePost(postId, btn) {
      try {
        const res = await fetch(`/api/posts/${postId}/unarchive`, {
          method: 'PUT',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        btn.closest('.pf-user-list-item').remove();
        showToast('Post unarchived!');
        // Refresh counts
        const countEl = document.getElementById('pf-posts-count');
        let count = parseInt(countEl.textContent) || 0;
        countEl.textContent = count + 1;
      } catch (err) {
        showToast('Failed to unarchive post');
      }
    }

    // ===== SAVED POSTS =====
    async function showSavedPosts() {
      closeSettingsDrawer();
      try {
        const res = await fetch(`/api/users/${currentUser.id}/saved`, {
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed');
        const data = await res.json();
        const posts = data.posts || [];

        document.getElementById('pf-list-title').textContent = 'Saved Posts';
        const body = document.getElementById('pf-list-body');

        if (posts.length === 0) {
          body.innerHTML = `<div style="padding:48px;text-align:center;color:var(--pf-text2);"><i class="fas fa-bookmark" style="font-size:40px;opacity:0.2;display:block;margin-bottom:12px;"></i><h3 style="margin-bottom:8px;color:var(--pf-text);">No Saved Posts</h3><p>Save posts to see them here.</p></div>`;
        } else {
          body.innerHTML = `<div class="pf-ig-grid">${posts.map(p => {
            const images = Array.isArray(p.images) ? p.images : [];
            const likes = p.likes_count || 0;
            const comments = p.comments_count || 0;
            return `<div class="pf-ig-grid-item" onclick="viewPost(${p.id})">
              ${images.length > 0
                ? `<img src="${images[0]}" alt="Post" loading="lazy" onerror="this.style.display='none'">`
                : p.video_url
                  ? `<div style="width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;"><i class="fas fa-play-circle" style="font-size:32px;color:rgba(255,255,255,0.6);"></i></div>`
                  : `<div class="pf-ig-grid-text">${(p.content || 'Post').substring(0, 80)}</div>`
              }
              ${p.video_url ? '<span class="pf-ig-grid-video"><i class="fas fa-play"></i></span>' : ''}
              <div class="pf-ig-grid-overlay">
                <span class="pf-ig-grid-stat"><i class="fas fa-heart"></i> ${likes}</span>
                <span class="pf-ig-grid-stat"><i class="fas fa-comment"></i> ${comments}</span>
              </div>
            </div>`;
          }).join('')}</div>`;
        }
        document.getElementById('pf-list-modal').style.display = 'flex';
      } catch (err) {
        showToast('Failed to load saved posts');
      }
    }

    // ===== Project CRUD (existing) =====
    function openProjectModal(projectId) {
      document.getElementById('pf-edit-project-id').value = '';
      document.getElementById('pf-project-name').value = '';
      document.getElementById('pf-project-desc').value = '';
      document.getElementById('pf-project-tech').value = '';
      document.getElementById('pf-project-url').value = '';
      document.getElementById('pf-project-thumb').value = '';
      document.getElementById('pf-modal-title').textContent = 'Add Project';
      document.getElementById('pf-project-modal').style.display = 'flex';
    }

    function closeProjectModal() {
      document.getElementById('pf-project-modal').style.display = 'none';
    }

    function editProject(id) {
      const p = portfolioProjects.find(x => x.id === id);
      if (!p) return;
      document.getElementById('pf-edit-project-id').value = id;
      document.getElementById('pf-project-name').value = p.name || '';
      document.getElementById('pf-project-desc').value = p.description || '';
      document.getElementById('pf-project-tech').value = p.technologies || '';
      document.getElementById('pf-project-url').value = p.url || '';
      document.getElementById('pf-project-thumb').value = p.thumbnail || '';
      document.getElementById('pf-modal-title').textContent = 'Edit Project';
      document.getElementById('pf-project-modal').style.display = 'flex';
    }

    async function saveProject() {
      const id = document.getElementById('pf-edit-project-id').value;
      const body = {
        name: document.getElementById('pf-project-name').value.trim(),
        description: document.getElementById('pf-project-desc').value.trim(),
        technologies: document.getElementById('pf-project-tech').value.trim(),
        url: document.getElementById('pf-project-url').value.trim(),
        thumbnail: document.getElementById('pf-project-thumb').value.trim()
      };

      if (!body.name) return alert('Project name is required');

      try {
        const method = id ? 'PUT' : 'POST';
        const url = id ? `/api/portfolio/projects/${id}` : '/api/portfolio/projects';
        const res = await fetch(url, {
          method,
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });

        if (!res.ok) throw new Error('Failed to save project');
        closeProjectModal();
        await loadProjects();
        showToast(id ? 'Project updated!' : 'Project added!');
      } catch (err) {
        console.error('Save project error:', err);
        showToast('Failed to save project');
      }
    }

    async function deleteProject(id) {
      if (!confirm('Delete this project?')) return;
      try {
        const res = await fetch(`/api/portfolio/projects/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (!res.ok) throw new Error('Failed to delete');
        await loadProjects();
        showToast('Project deleted');
      } catch (err) {
        console.error('Delete project error:', err);
        showToast('Failed to delete project');
      }
    }

    // ===== Animations (existing) =====
    function initScrollReveal() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
          }
        });
      }, { threshold: 0.1 });

      document.querySelectorAll('.pf-reveal').forEach(el => observer.observe(el));
      setTimeout(() => {
        document.querySelectorAll('.pf-reveal').forEach((el, i) => {
          setTimeout(() => el.classList.add('visible'), i * 120);
        });
      }, 100);
    }

    function initTilt3D() {
      document.querySelectorAll('.pf-3d-tilt').forEach(card => {
        if (card._tiltBound) return;
        card._tiltBound = true;

        card.addEventListener('mousemove', (e) => {
          const rect = card.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          const rotateX = ((y - centerY) / centerY) * -8;
          const rotateY = ((x - centerX) / centerX) * 8;
          card.style.transform = `perspective(800px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-4px) scale(1.02)`;
        });

        card.addEventListener('mouseleave', () => {
          card.style.transform = '';
          card.style.transition = 'transform 0.5s ease';
          setTimeout(() => { card.style.transition = ''; }, 500);
        });
      });
    }

    function animateCounters() {
      document.querySelectorAll('.pf-stat-number').forEach(el => {
        const target = parseInt(el.textContent) || 0;
        if (target === 0) return;
        let current = 0;
        const step = Math.max(1, Math.floor(target / 30));
        const interval = setInterval(() => {
          current += step;
          if (current >= target) { current = target; clearInterval(interval); }
          el.textContent = current;
        }, 30);
      });
    }

    function formatTimeAgo(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);
      if (diff < 60) return 'just now';
      if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
      if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
      if (diff < 604800) return Math.floor(diff / 86400) + 'd ago';
      return date.toLocaleDateString();
    }

    function sharePortfolio() {
      const url = window.location.href;
      if (navigator.share) {
        navigator.share({ title: 'Profile', url });
      } else {
        navigator.clipboard.writeText(url);
        showToast('Link copied!');
      }
    }

    // ESC key handler for all modals/drawers
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeEditProfileModal();
        closeProjectModal();
        closeListModal();
        closeSettingsDrawer();
        closeCropper();
      }
    });

    // Init
    initPortfolio();
  </script>
</body>
</html>
